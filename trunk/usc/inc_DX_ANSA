'HFC 
'Diagnosis Record
'#54

%global DX_DCT,DX_DCT2,DX_DCT3,DX_DCT4,DX_DCT5,DX_DCT6
DX_DCT  is b
DX_DCT2 is b
DX_DCT3 is b
DX_DCT4 is b
DX_DCT5 is b
DX_DCT6 is b

'*********Datacode Tables, Change These*****************
DX_DCT = 400    
DX_DCT2 = DX_DCT
DX_DCT3 = DX_DCT
DX_DCT4 = DX_DCT
DX_DCT5 = DX_DCT
DX_DCT6 = DX_DCT
'*******************************************************

%global dx_dstlist
%global c.dsmiiir,c.diag,c.dx.when,c.dx4,c.dxaxi2,c.dxaxi3,c.dxaxi4,c.dxaxi5,c.dxaxi6,c.dxaxii1,c.dxaxii2,c.dxaxii3,c.dxaxii4,c.dxaxii5,c.dxaxii6,
%global c.dxaxiii1,c.dxaxiii2,c.dxaxiii3,c.dxaxiii4,c.dxaxiii5,c.dxaxiii6,c.dxaxiv,c.dxaxvp,c.dxaxvc,c.cabl,c.pabl,c.dxdate,c.dxiiidte,c.prdxaxis,c.dxreason,c.dx.comment,
%global c.dx.isn,c.dxaxiv-a,c.who.diag,c.dx.stat,c.dxflag,c.a1l1,c.dx.ax3,c.dx.ax4.a,c.dx.ser,c.dx.time,c.dx.dur,c.dx.ru,c.dx.loc,c.dx.proj,c.dx.serv,c.dx.fill,c.dx.comme,c.dx.by,
%global c.dx.ax4.c,c.dx.ax4.d,c.paamd,c.saamd,c.taamd,c.genetic,c.c.anomal,c.sen.imp,c.precept,c.conv.dis,c.psy.impa,c.motor.dy,c.aamd.dat,c.iq.score,
%global c.iq.date,c.iq.type,c.sq.score,c.sq.date,c.sq.type,c.dx.prese,c.dx.ax4.b,c.dx.ax4.e,c.dx.ax4.f,c.dx.ax4.g,c.dx.ax4.h,c.dx.sys,c.dx.ax4.i,c.dx.ax4.j,c.dx.needed

rc_dx_dstlist   is i
dx_dstlist      is dstlist
c.dsmiiir       is h   'DSM-IIIR DIAGNOSIS RECORD      
c.diag          is x   'AXIS I LEVEL 1                 
c.dx.when       is x   'WHEN? (A=ADM,E=EST,D=DISCH)    
c.dx4           is x   'DSM-IV AXIS I & II CODES       
c.dxaxi2        is x   'AXIS I LEVEL 2                 
c.dxaxi3        is x   'AXIS I LEVEL 3                 
c.dxaxi4        is x   'AXIS I LEVEL 4                 
c.dxaxi5        is x   'AXIS I LEVEL 5                 
c.dxaxi6        is x   'AXIS I LEVEL 6                 
c.dxaxii1       is x   'AXIS II LEVEL 1                
c.dxaxii2       is x   'AXIS II LEVEL 2                
c.dxaxii3       is x   'AXIS II LEVEL 3                
c.dxaxii4       is x   'AXIS II LEVEL 4                
c.dxaxii5       is x   'AXIS II LEVEL 5                
c.dxaxii6       is x   'AXIS II LEVEL 6                
c.dxaxiii1      is x   'AXIS III LEVEL 1               
c.dxaxiii2      is x   'AXIS III LEVEL 2               
c.dxaxiii3      is x   'AXIS III LEVEL 3               
c.dxaxiii4      is x   'AXIS III LEVEL 4               
c.dxaxiii5      is x   'AXIS III LEVEL 5               
c.dxaxiii6      is x   'AXIS III LEVEL 6               
c.dxaxiv        is x   'AXIS IV                        
c.dxaxvp        is x   'AXIS V-PAST GLOBAL ASSESSMENT  
c.dxaxvc        is x   'AXIS V-CURRENT GLOBAL ASSESS.  
c.cabl          is x   'CURRENT ABL                    
c.pabl          is x   'POTENTIAL ABL                  
c.dxdate        is d   'DIAGNOSIS DATE                 
c.dxiiidte      is d   'AXIS III DIAGNOSIS DATE        
c.prdxaxis      is x   'PRINCIPAL DIAGNOSIS AXIS       
c.dxreason      is x   'REASON FOR DIAGNOSIS           
c.dx.comment    is x   'DIAGNOSIS COMMENTS             
c.dx.isn        is x   'DIAGNOSIS ISN REFERENCE        
c.dxaxiv-a      is x   'AXIS IV (01/01/95 VERSION)     
c.who.diag      is x   'WHO DIAGNOSED CLIENT(?)        
c.dx.stat       is x   'DIAGNOSIS STATUS               
c.dxflag        is d   'DIAGNOSIS FLAG DATE            
c.a1l1          is x   'AXIS I LEVEL I                 
c.dx.ax3        is x   'AXIS III                       
c.dx.ax4.a      is x   'AXIS IV A                      
c.dx.ser        is b   'DIAGNOSIS SERVICE CODE         
c.dx.time       is t   'DIAGNOSIS START TIME           
c.dx.dur        is t   'DIAGNOSIS DURATION             
c.dx.ru         is b   'DIAGNOSIS RU                   
c.dx.loc        is x   'DIAGNOSIS LOCATION CODE        
c.dx.proj       is b   'DIAGNOSIS PROJECT CODE         
c.dx.serv       is x   'DX SERVICE WITH COUNSELING     
c.dx.fill       is x   'CLIENT DSM-IV FILLER           
c.dx.comme      is x   'DIAGNOSIS COMMENTS             
c.dx.by         is x   'DIAGNOSIS MADE BY              
c.dx.ax4.c      is x   'DSM-IV AXIS IV LEVEL C         
c.dx.ax4.d      is x   'DSM-IV AXIS IV LEVEL D         
c.paamd         is x   'PRIMARY AAMD                   
c.saamd         is x   'SECONDARY AAMD                 
c.taamd         is x   'TERTIARY AAMD                  
c.genetic       is x   'GENETIC                        
c.c.anomal      is x   'CRANIAL ANOMALY                
c.sen.imp       is x   'SENSORY IMPARIAMENT            
c.precept       is x   'PRECEPTION                     
c.conv.dis      is x   'CONVULSIVE DISORDER            
c.psy.impa      is x   'PSYCH IMPARMENT                
c.motor.dy      is x   'MOTOR DYSFUCTION               
c.aamd.dat      is d   'AAMD DATE                      
c.iq.score      is x   'IQ SCORE                       
c.iq.date       is d   'IQ TEST DATE                   
c.iq.type       is x   'IQ SCORE TYPE                  
c.sq.score      is x   'SQ SCORE                       
c.sq.date       is d   'SQ TEST DATE                   
c.sq.type       is x   'SQ TEST TYPE                   
c.dx.prese      is x   'PRESENTING ISSUE               
c.dx.ax4.b      is x   'DSM-IV AXIS IV LEVEL B         
c.dx.ax4.e      is x   'DSM-IV AXIS IV LEVEL E         
c.dx.ax4.f      is x   'DSM-IV AXIS IV LEVEL F         
c.dx.ax4.g      is x   'DSM-IV AXIS IV LEVEL G         
c.dx.ax4.h      is x   'DSM-IV AXIS IV LEVEL H         
c.dx.sys        is x   'DIAGNOSIS SYSTEM               
c.dx.ax4.i      is x   'DSM-IV AXIS IV LEVEL I         
c.dx.ax4.j      is x   'DSM-IV, AXIS IV LEVEL J        
c.dx.needed     is x   'NEW DIAGNOSIS NEEDED FLAG

rc_dx_dstlist = $dstlist(dx_dstlist,02,
c.dsmiiir,c.diag,c.dx.when,c.dx4,c.dxaxi2,c.dxaxi3,c.dxaxi4,c.dxaxi5,c.dxaxi6,c.dxaxii1,c.dxaxii2,c.dxaxii3,c.dxaxii4,c.dxaxii5,c.dxaxii6,
c.dxaxiii1,c.dxaxiii2,c.dxaxiii3,c.dxaxiii4,c.dxaxiii5,c.dxaxiii6,c.dxaxiv,c.dxaxvp,c.dxaxvc,c.cabl,c.pabl,c.dxdate,c.dxiiidte,c.prdxaxis,c.dxreason,c.dx.comment,
c.dx.isn,c.dxaxiv-a,c.who.diag,c.dx.stat,c.dxflag,c.a1l1,c.dx.ax3,c.dx.ax4.a,c.dx.ser,c.dx.time,c.dx.dur,c.dx.ru,c.dx.loc,c.dx.proj,c.dx.serv,c.dx.fill,c.dx.comme,c.dx.by,
c.dx.ax4.c,c.dx.ax4.d,c.paamd,c.saamd,c.taamd,c.genetic,c.c.anomal,c.sen.imp,c.precept,c.conv.dis,c.psy.impa,c.motor.dy,c.aamd.dat,c.iq.score,
c.iq.date,c.iq.type,c.sq.score,c.sq.date,c.sq.type,c.dx.prese,c.dx.ax4.b,c.dx.ax4.e,c.dx.ax4.f,c.dx.ax4.g,c.dx.ax4.h,c.dx.sys,c.dx.ax4.i,c.dx.ax4.j,c.dx.needed)

 function GETDX(DXType,DX,DXCat,DXDate,DXGaf) is null
  DXType is x
  DX     is x
  DXCat  is x
  DXDate is d
  DXGaf  is i
  rc     is b 

  rc = $dbread(02, $regid, dx_dstlist)  
  dxtype = $dct(dx_dct, c.diag, "1")
  DX     = c.diag
  DXGaf  = c.dxaxvc
  DXDate = c.dxdate
 
  if dxtype = "O" and C.DXAXI2 dp
   dxtype = $dct(dx_dct, C.DXAXI2, "1")
   if dxtype = "S" or dxtype = "B" or dxtype = "D"
 	DX = C.DXAXI2
   endif
  endif
  if dxtype = "O" and C.DXAXI3 dp
   dxtype = $dct(dx_dct, C.DXAXI3, "1")
   if dxtype = "S" or dxtype = "B" or dxtype = "D"
    DX = C.DXAXI3
   endif
  endif
  if dxtype = "O" and C.DXAXI4 dp
   dxtype = $dct(dx_dct, C.DXAXI4, "1")
   if dxtype = "S" or dxtype = "B" or dxtype = "D"
    DX = C.DXAXI4
   endif
  endif
  if dxtype = "O" and C.DXAXI5 dp
   dxtype = $dct(dx_dct, C.DXAXI5, "1")
   if dxtype = "S" or dxtype = "B" or dxtype = "D"
    DX = C.DXAXI5
   endif
  endif
  if dxtype = "O" and C.DXAXI6 dp
   dxtype = $dct(dx_dct, C.DXAXI6, "1")
   if dxtype = "S" or dxtype = "B" or dxtype = "D"
    DX = C.DXAXI6
   endif
  endif
  select DXType
   case "B" dxcat = "Bipolar"
   case "S" dxcat = "Schizophrenia"
   case "D" select DX
             case "29624" dxcat = "MDD - With Psychotic Features"
			 case "29634" dxcat = "MDD - With Psychotic Features"
             case "296.24" dxcat = "MDD - With Psychotic Features"
			 case "296.34" dxcat = "MDD - With Psychotic Features"
			 case other    dxcat = "MDD - Without Psychotic Features"
			endselect 
   case "O" dxcat = "Other"
   case !dp dxcat = "Other"
            DXType = "O"
  endselect
  $allowupdate(dxtype, DX, dxcat, DXGAF, DXDate)
 end GETDX

 function CurrentDX(client,compare_date) is x
  client       is x
  compare_date is d
  dx_age       is i

  CurrentDX = "Y"
  if compare_date !dp
   compare_date = $today
  endif
  (void)$dbread(02,client,dx_dstlist)
  (void)$datediff(c.dxdate,compare_date,dx_age)
  if c.diag !dp or dx_age > 0
   CurrentDX = "N"
  endif
 end CurrentDX 
