start UM_MONITOR3()
 %global bgcolor, row_color, formtimeout
 %global assessment_date, assessment_ID, assessment_name, assessment, assessment_type, assessment_rloc, assessment_dloc, assessment_adate, assessment_pfile, assessment_opt, view_btn, assessment_staff,assessment_sname
 %global ansa_sl, cans35_sl, cans617_sl, ansa_bsl, cans35_bsl, cans617_bsl, cabd_sl, uabd_sl, cabd_bsl, uabd_bsl
 bgcolor     is x
 row_color   is x
 formtimeout is i

 ansa_sl     is x
 cans35_sl   is x
 cans617_sl  is x
 cabd_sl     is x
 uabd_sl     is x

 ansa_bsl    is x
 cans35_bsl  is x
 cans617_bsl is x
 cabd_bsl    is x
 uabd_bsl    is x

'*****************************Change these******************************************************************
 %define table_wbgcolor "width='100%' cellspacing='0' cellpadding='0' bgcolor='" + bgcolor + "'"
 %define table_nobgcolor "width='100%' cellspacing='0' cellpadding='0'"
 %define row_odd "bgcolor='White'"
 %define row_even "bgcolor='CornSilk'"
 %define row_color3 "bgcolor='PaleGreen'"
 %define old_assessment "bgcolor='LightSalmon'" 
 %define crisis_color "bgcolor='Crimson'" 
 %define override_color "bgcolor='YellowGreen'" 
 %define col_color_multi "bgcolor='LightGrey'"
'How often to refresh the main form
 formtimeout = 60
'Pending saved List
 ansa_sl    = "ANSAP"
 cans35_sl  = "CANS35P"
 cans617_sl = "CANS617P"
 cabd_sl    = "CABDP"
 uabd_sl    = "UABDP"
 
'Ready to batch saved lists
 ansa_bsl    = "ANSAB"
 cans35_bsl  = "CANS35B"
 cans617_bsl = "CANS617B" 
 cabd_bsl    = "CABDB"
 uabd_bsl    = "UABDB"
'*********************************************************************************************************** 

 $looplimit = 0
 assessments[]      is x
 view_btn[]         is x
 file-list[]        is x
 file-name[]        is x
 assessment_date[]  is d
 assessment_ID[]    is x
 assessment_name[]  is x
 assessment[]       is x
 assessment_type[]  is x
 assessment_rloc[]  is x
 assessment_dloc[]  is x
 assessment_adate[] is x
 assessment_pfile[] is x
 assessment_opt[]   is x
 assessment_staff[] is x
 assessment_sname[] is x
 
 %global pending, cans35_count, cans617_count, ansa_count, uabd_count, cabd_count
 pending       is i
 cans35_count  is i
 cans617_count is i
 ansa_count    is i
 uabd_count    is i
 cabd_count    is i

 index         is i
 rc            is i 
 
 do while 1 = 1
   GetSavedLists()
   ViewLists()
  select $endbutton
   case "SUBMIT"
   case "CANCEL" return
   case other if $maxarray(view_btn[]) > 0
               index = $maxarray(view_btn[])
               select assessment[index]
	            case "ANSA" if ConfirmANSA(assessment_id[index]) = 1
	                         (void)$arrremove(file-name[index],1,assessment_date[],assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_adate[],assessment_staff[], assessment_sname[])
                             $brmsg("This assessment has already been authorized before the screen refreshed.",1,"W","Assessment Already Authorized")
							else 
							 call assessment[index](,,assessment_id[index])
				            endif
	            case "CANS35" if ConfirmCANS(assessment_id[index]) = 1
	                         (void)$arrremove(file-name[index],1,assessment_date[],assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_adate[],assessment_staff[], assessment_sname[])
                             $brmsg("This assessment has already been authorized before the screen refreshed.",1,"W","Assessment Already Authorized")
							else 
							 call assessment[index](,,assessment_id[index])
				            endif

	            case "CANS617" if ConfirmCANS(assessment_id[index]) = 1
	                         (void)$arrremove(file-name[index],1,assessment_date[],assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_adate[],assessment_staff[], assessment_sname[])
                             $brmsg("This assessment has already been authorized before the screen refreshed.",1,"W","Assessment Already Authorized")
							else 
							 call assessment[index](,,assessment_id[index])
				            endif
	            case "UABD" if ConfirmUABD(assessment_id[index]) = 1
	                         (void)$arrremove(file-name[index],1,assessment_date[],assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_adate[],assessment_staff[], assessment_sname[])
                             $brmsg("This assessment has already been authorized before the screen refreshed.",1,"W","Assessment Already Authorized")
							else 
							 call assessment[index](,,assessment_id[index])
				            endif
	            case "CABD" if ConfirmCABD(assessment_id[index]) = 1
	                         (void)$arrremove(file-name[index],1,assessment_date[],assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_adate[],assessment_staff[], assessment_sname[])
                             $brmsg("This assessment has already been authorized before the screen refreshed.",1,"W","Assessment Already Authorized")
							else 
							 call assessment[index](,,assessment_id[index])
				            endif
               endselect					      		   			   
		       $clear(view_btn[])
		      endif
  endselect
 enddo
end UM_MONITOR3

function ViewLists() is null
 $clear(view_btn[])
 index is i
 $submitopt("off", "Refresh")
 $cancelopt("off", "Exit")
 $form($funcname)
  $setformtimeout(formtimeout)
  $br()
  $table($funcname)
   $row()
    $col(,,"10%")$text("Pending: ","datatag")
	$col(,,"10%")$text(pending,"error")
	$col(,,"80%")
   if ansa_count > 0
    $row()
     $col()$text("ANSA: ","datatag")
	 $col()$text(ansa_count,"error")
	 $col()	
   endif
   if cans35_count > 0
    $row()
     $col()$text("CANS 3-5: ","datatag")
	 $col()$text(cans35_count,"error")
	 $col()	
   endif
   if cans617_count > 0
    $row()
     $col()$text("CANS 6-17: ","datatag")
	 $col()$text(cans617_count,"error")
	 $col()		
   endif
   if uabd_count > 0
    $row()
     $col()$text("Adult UA: ","datatag")
	 $col()$text(uabd_count,"error")
	 $col()		
   endif
   if cabd_count > 0
    $row()
     $col()$text("Child UA: ","datatag")
	 $col()$text(cabd_count,"error")
	 $col()		
   endif
  $endtable($funcname)
  $br()
  $table($funcname)
   $row()
    $col()$text("Date","datatag")
    $col()$text("ID","datatag")
    $col()$text("Name","datatag")
    $col()$text("Assessment","datatag")
    if $maxarray(assessment[]) > 0
	 $col()$text("Type","datatag")
	endif 
    if $maxarray(assessment_rloc[]) > 0
	 $col()$text("RLOC","datatag")
	endif 
    if $maxarray(assessment_dloc[]) > 0
	 $col()$text("DLOC","datatag")
	endif 
    if $maxarray(assessment_adate[]) > 0
	 $col()$text("Authorize By Date","datatag")
	endif 
	$col()$text("Staff","datatag")	
	$col()$text("Staff Name","datatag")		
   $row()
    $col()$tag("<hr/>")	
    $col()$tag("<hr/>")	
    $col()$tag("<hr/>")	
    $col()$tag("<hr/>")	
    if $maxarray(assessment_type[]) > 0
     $col()$tag("<hr/>")	
    endif
    if $maxarray(assessment_rloc[]) > 0
	 $col()$tag("<hr/>")	
    endif
    if $maxarray(assessment_dloc[]) > 0
	 $col()$tag("<hr/>")	
    endif
    if $maxarray(assessment_adate[]) > 0
	 $col()$tag("<hr/>")
	endif 
    $col()$tag("<hr/>")	
    $col()$tag("<hr/>")	
   index = 0
   $bstyle("link","link")
   do while index++ < pending
    if $mod(index,2) = 0
	 row_color = row_odd
	else
	 row_color = row_even
	endif
    if assessment_dloc[index] dp and assessment_dloc[index] != assessment_rloc[index]
	 row_color = override_color
	endif
	if assessment_adate[index] <= $today
	 row_color = old_assessment
	endif	
	select assessment[index])
	 case "UABD" select assessment_rloc[index])  
	                  case "0" row_color = crisis_color
	                 endselect
	 case "CABD" select assessment_rloc[index])  
	                  case "0" row_color = crisis_color
	                 endselect
	 case "ANSA" select assessment_rloc[index])  
	              case "100" row_color = crisis_color
	             endselect
	 case "CANS35" select assessment_rloc[index])  
	                case "100" row_color = crisis_color
	               endselect
	 case "CANS617" select assessment_rloc[index])  
	                 case "100" row_color = crisis_color
	                endselect
	endselect
    select assessment[index])
	 case "ANSA" $row(,row_color)           
                  $col()$submit(view_btn[index],`assessment_date[index]`)
                  $col()$text(assessment_id[index]) 
                  $col()$text(assessment_name[index]) 
                  if $maxarray(assessment_type[]) > 0
				   $col()$text(assessment_type[index])
                  endif
				  if $maxarray(assessment_rloc[]) > 0
				   $col()$text(assessment_rloc[index])
                  endif
				  if $maxarray(assessment_dloc[]) > 0
				   $col()$text(assessment_dloc[index])
                  endif
	 case "CANS35" $row(,row_color)
                    $col()$submit(view_btn[index],`assessment_date[index]`)
                    $col()$text(assessment_id[index])
                    $col()$text(assessment_name[index]) 
                    $col()$text(assessment[index])
                    if $maxarray(assessment_type[]) > 0
					 $col()$text(assessment_type[index])
                    endif
					if $maxarray(assessment_rloc[]) > 0
					 $col()$text(assessment_rloc[index])
                    endif
					if $maxarray(assessment_dloc[]) > 0
					 $col()$text(assessment_dloc[index])
                    endif
	 case "CANS617" $row(,row_color)
                     $col()$submit(view_btn[index],`assessment_date[index]`)
                     $col()$text(assessment_id[index])
                     $col()$text(assessment_name[index]) 
				     $col()$text(assessment[index])
                     if $maxarray(assessment_type[]) > 0
                      $col()$text(assessment_type[index])
                     endif
					 if $maxarray(assessment_rloc[]) > 0
					  $col()$text(9705,assessment_rloc[index])
                     endif
					 if $maxarray(assessment_dloc[]) > 0
					  $col()$text(assessment_dloc[index])
				     endif
	 case "UABD" $row(,row_color)
                      $col()$submit(view_btn[index],`assessment_date[index]`)
                      $col()$text(assessment_id[index])
                      $col()$text(assessment_name[index]) 
				      $col()$text(assessment[index])
                      if $maxarray(assessment_type[]) > 0
					   $col()$text(assessment_type[index])
                      endif
					  if $maxarray(assessment_rloc[]) > 0
					   $col()$text(assessment_rloc[index])
                      endif
					  if $maxarray(assessment_dloc[]) > 0
					   $col()$text(assessment_dloc[index])
				      endif
	 case "CABD" $row(,row_color)
                      $col()$submit(view_btn[index],`assessment_date[index]`)
                      $col()$text(assessment_id[index])
                      $col()$text(assessment_name[index]) 
                      $col()$text(assessment[index])
                      if $maxarray(assessment_type[]) > 0
					   $col()$text(assessment_type[index])
                      endif
					  if $maxarray(assessment_rloc[]) > 0
					   $col()$text(assessment_rloc[index])
                      endif
					  if $maxarray(assessment_dloc[]) > 0
					   $col()$text(assessment_dloc[index])
				      endif
	endselect
    if $maxarray(assessment_adate[]) > 0
     $col()$text(assessment_adate[index])   
	endif 
    $col()$text(assessment_staff[index])   				  
    $col()$text(assessment_sname[index])   				  				  	
   enddo		
  $endtable($funcname)
 $sendform($funcname)
end ViewLists

function GetSavedLists() is null
 rc    			is i
 index 			is i
 ansa_list[]    is x
 cans35_list[]  is x
 cans617_list[] is x
 uabd_list[]    is x
 cabd_list[]    is x
 
 s.fn 		  is x
 s.ln 		  is x
 c.fn 		  is x
 c.ln 		  is x
'Ansa
 c.ansa.rec   is h
 c.ansa.date  is d
 c.ansa.type  is x
 c.ansa.rloc  is x
 c.ansa.dloc  is x
 c.ansa.staff is x
'CANS35/CANS617
 c.cans.rec   is h
 c.cans.date  is d
 c.cans.type  is x
 c.cans.rloc  is x
 c.cans.dloc  is x
 c.cans.staff is x
'RDM Adult UA
 c.uabd       is h
 c.uabd.date  is d
 c.uabd.pur   is x
 c.uabd.rloc  is x
 c.uabd.request  is x
 c.uabd.staff1 is x
'RDM Child UA
 c.cabd.rec   is h
 c.cabd.date  is d
 c.cabd.ass   is x
 c.cabd.rloc  is x
 c.cabd.request  is x
 c.cabd.staff is x

 $clear(assessment_adate[],assessment_date[],assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_staff[],assessment_sname[])  
 rc = $getlist(ansa_list[],2,ansa_sl)
 index = 0
 ansa_count = $maxarray(ansa_list[])
 do while index++ < ansa_count
  rc = $dbread(2,ansa_list[index],c.fn,c.ln,c.ansa.rec,c.ansa.date,c.ansa.type,c.ansa.rloc,c.ansa.dloc,c.ansa.staff)
  rc = $dbread(3,c.ansa.staff,s.fn,s.ln)
  assessment[index]       = "ANSA"
  assessment_date[index]  = c.ansa.date
  assessment_ID[index]    = ansa_list[index]
  assessment_name[index]  = c.fn + " " + c.ln
  assessment_type[index]  = $ncs($dct(9700,c.ansa.type))
  assessment_rloc[index]  = $ncs($dct(9712,c.ansa.rloc))
  assessment_dloc[index]  = $ncs($dct(9712,c.ansa.dloc))
  assessment_adate[index] = c.ansa.date + 14
  assessment_staff[index] = c.ansa.staff
  assessment_sname[index] = s.fn + " " + s.ln
 enddo 

 rc = $getlist(cans35_list[],2,cans35_sl)
 index = 0
 cans35_count = $maxarray(cans35_list[])
 do while index++ < cans35_count
  rc = $dbread(2,cans35_list[index],c.fn,c.ln,c.cans.rec,c.cans.date,c.cans.type,c.cans.rloc,c.cans.dloc,c.cans.staff)
  rc = $dbread(3,c.cans.staff,s.fn,s.ln)
  assessment[index]       = "CANS35"
  assessment_date[index]  = c.cans.date
  assessment_ID[index]    = cans35_list[index]
  assessment_name[index]  = c.fn + " " + c.ln
  assessment_type[index]  = $ncs($dct(9700,c.cans.type))
  assessment_rloc[index]  = $ncs($dct(9705,c.cans.rloc))
  assessment_dloc[index]  = $ncs($dct(9705,c.cans.dloc))
  assessment_adate[index] = c.cans.date + 14
  assessment_staff[index] = c.cans.staff
  assessment_sname[index] = s.fn + " " + s.ln
 enddo  

 rc = $getlist(cans617_list[],2,cans617_sl)
 index = 0
 cans617_count = $maxarray(cans617_list[])
 do while index++ < cans617_count
  rc = $dbread(2,cans617_list[index],c.fn,c.ln,c.cans.rec,c.cans.date,c.cans.type,c.cans.rloc,c.cans.dloc,c.cans.staff)
  rc = $dbread(3,c.cans.staff,s.fn,s.ln)
  assessment[index]       = "CANS617"
  assessment_date[index]  = c.cans.date
  assessment_ID[index]    = cans617_list[index]
  assessment_name[index]  = c.fn + " " + c.ln
  assessment_type[index]  = $ncs($dct(9700,c.cans.type))
  assessment_rloc[index]  = $ncs($dct(9705,c.cans.rloc))
  assessment_dloc[index]  = $ncs($dct(9705,c.cans.dloc))
  assessment_adate[index] = c.cans.date + 14
  assessment_staff[index] = c.cans.staff
  assessment_sname[index] = s.fn + " " + s.ln
 enddo

 rc = $getlist(uabd_list[],2,uabd_sl)
 index = 0
 uabd_count = $maxarray(uabd_list[])
 do while index++ < uabd_count
  rc = $dbread(2,uabd_list[index],c.fn,c.ln,c.uabd,c.uabd.date,c.uabd.pur,c.uabd.rloc,c.uabd.request,c.uabd.staff1)
  rc = $dbread(3,c.uabd.staff1,s.fn,s.ln)
  assessment[index]       = "UABD"
  assessment_date[index]  = c.uabd.date
  assessment_ID[index]    = uabd_list[index]
  assessment_name[index]  = c.fn + " " + c.ln
  assessment_type[index]  = $ncs($dct(9000,c.uabd.pur))
  assessment_rloc[index]  = $ncs($dct(9001,c.uabd.rloc))
  assessment_dloc[index]  = $ncs($dct(9001,c.uabd.request))
  assessment_adate[index] = c.uabd.date + 14
  assessment_staff[index] = c.uabd.staff1
  assessment_sname[index] = s.fn + " " + s.ln
 enddo     

 rc = $getlist(cabd_list[],2,cabd_sl)
 index = 0
 cabd_count = $maxarray(cabd_list[])
 do while index++ < cabd_count
  rc = $dbread(2,cabd_list[index],c.fn,c.ln,c.cabd.rec,c.cabd.date,c.cabd.ass,c.cabd.rloc,c.cabd.request,c.cabd.staff)
  rc = $dbread(3,c.cabd.staff,s.fn,s.ln)
  assessment[index]       = "CABD"
  assessment_date[index]  = c.cabd.date
  assessment_ID[index]    = cabd_list[index]
  assessment_name[index]  = c.fn + " " + c.ln
  assessment_type[index]  = $ncs($dct(9000,c.cabd.ass))
  assessment_rloc[index]  = $ncs($dct(9014,c.cabd.rloc))
  assessment_dloc[index]  = $ncs($dct(9014,c.cabd.request))
  assessment_adate[index] = c.cabd.date + 14
  assessment_staff[index] = c.cabd.staff
  assessment_sname[index] = s.fn + " " + s.ln
 enddo      

 rc = $sort(assessment_adate[],"A",assessment_date[],"A",assessment_ID[],assessment_name[],assessment[],assessment_type[],assessment_rloc[],assessment_dloc[],assessment_staff[],assessment_sname[])
 pending = cans35_count + cans617_count + ansa_count + uabd_count + cabd_count
end GetSavedLists

function ConfirmANSA(cid) is i
 cid          is x
 c.ansa.rec   is h
 c.ansa.compd is d
 (void)$dbread(2,cid,c.ansa.rec,c.ansa.compd)
 if c.ansa.compd dp
  ConfirmAnsa = 1
 else
  ConfirmAnsa = 0
 endif
end ConfirmAnsa

function ConfirmCANS(cid) is i
 cid          is x
 c.cans.rec   is h
 c.cans.compd is d
 (void)$dbread(2,cid,c.cans.rec,c.cans.compd)
 if c.cans.compd dp
  ConfirmCANS = 1
 else
  ConfirmCANS = 0
 endif
end ConfirmCANS

function ConfirmUABD(cid) is i
 cid         is x
 c.uabd      is h
 c.uabd.stat is x
 (void)$dbread(2,cid,c.uabd,c.uabd.stat)
 if c.uabd.stat = "2"
  ConfirmUABD = 1
 else
  ConfirmUABD = 0
 endif
end COnfirmUABD

function ConfirmCABD(cid) is i
 cid         is x
 c.cabd.rec  is h
 c.cabd.stat is x
 (void)$dbread(2,cid,c.cabd.rec,c.cabd.stat)
 if c.cabd.stat = "2"
  ConfirmCABD = 1
 else
  ConfirmCABD = 0
 endif
end ConfirmCABD

function ConfirmMRSVC(cid) is i
 cid            is x
 c.mrcoord.rec  is h
 c.mrcoord.stat is b
 (void)$dbread(2,cid,c.mrcoord.rec,c.mrcoord.stat)
 if c.mrcoord.stat = 2
  ConfirmMRSVC = 1
 else
  ConfirmMRSVC = 0
 endif
end ConfirmMRSVC

