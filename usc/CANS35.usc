start CANS35(parmfile,option,client,retcode)
 %version 1.0.040 06/12/2015
 $looplimit = 0
 %include inc_CANS35
 e.ser     is b
 e.ru      is b
 e.start   is t
 e.dur     is t
 e.loc     is x
 e.case.no is x
 e.staff   is x
 e.date    is d
 e.cl.dur  is t
 %global e.ser, e.ru, e.start, e.dur, e.loc, e.case.no, e.staff, e.date, e.cl.dur
 addsal is x
 
 %global radio_index
 radio_index is i

 %global c_cans_rloc, c_cans_dloc, c_cans_aloc,c_cans_loc_dev,c_cans_fairhear,c_cans_grade,c_cans_restype,sigline,medicaid_status
 c_cans_rloc     is x
 c_cans_dloc     is x
 c_cans_aloc     is x
 c_cans_loc_dev  is x
 c_cans_fairhear is x
 c_cans_grade    is x
 c_cans_restype  is x
 sigline         is x
 medicaid_status is x

 %global parmfile,option,client,retcode, rc
 parmfile is x
 option   is x
 client   is x
 retcode  is i
 rc       is i

'' if $regid !dp
''  if client dp
''   $regid = client
''  else
''   $regid = {"lib_UACOMMON"}GetClientID() 
''   if $regid !dp
''    return
''   endif
''  endif
'' elseif ($regid dp and client dp) and client != $regid
''  $regid = {"lib_UACOMMON"}GetClientID() 
''  if $regid !dp
''   return
''  endif
'' endif

 if "lib_CLIENT":pickClient(client) > 0 then return endif
 if client dp then $regid = client endif
 
 if $lc(option) = "reportonly" or $lc(option) = "bigreport"
  if $dbread(2, $regid, c.cans.rec, c.cans.date) < 2
   if {"l_snapLibSC"}sn_viewLatest(ReportID,Parmfile,$regid,2,$ScriptID) = 0
    retcode = "0"
   endif
  endif
  retcode = "0"
  return
 endif 

if {"lib_UACOMMON"}StaffCanDo() = 1
  return
 endif 

 if CheckStfCred = "Y"
  call "CHECK_UACREDENTIALS"()
 endif 
 
 if Validate() = 1
  {"lib_UACOMMON"}DisplayErrors(errors[])
  return
 endif
 
 %global assessments
 assessments[] is x
 {"lib_CANS"}Allow_Assesment($regid,assessments[]) 
 {"lib_UAMEDICAID"}check_medicaid($regid,medicaid_status) 

 %global bgcolor
 bgcolor is x 
 %define table_wbgcolor "width='100%' cellspacing='0' cellpadding='0' bgcolor='" + bgcolor + "'"
 %define table_nobgcolor "width='100%' cellspacing='0' cellpadding='0'"  
 %define row_color1 "bgcolor='LightSkyBlue'"
 %define row_color2 "bgcolor='White'"
 %define row_color3 "bgcolor='PaleGreen'"
 %define col_color_multi "bgcolor='LightGrey'"
 Page is x
 %global UM_StaffYN, StaffAssign_YN
 UM_StaffYN is x
 UM_StaffYN = {"lib_UACOMMON"}UMStaff()
'****DENTON*****
 StaffAssign_YN is x
 StaffAssign_YN = {"lib_UACOMMON"}StaffAssign()
'************* 
 %global PromptNED
 PromptNED is i

 if UM_StaffYN = "Y"
  rc = $dbread(02, $regid, c.cans.rec,c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
  if c.cans.compd !dp and c.cans.type dp
   if c.cans.canstype != "2"
    $brmsg("A CANS 6-17 Assessment is Currently Being Entered!",1,"C","In Progress")
    $brmsg("The assessment will exit now.",2,"W")
    return
   endif	    
   select c.cans.staff
    case $operstaffid select {"lib_CANS"}PromptNewEditDel($regid)
                       case 1 $dblock()
                              rc = $dbread(02, $regid, c.cans.rec,c.cans.date)	
                              rc = $dbremovedst(02, $regid, c.cans.rec,c.cans.date)
							  $clear(c.cans.date,c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
		                      $brmsg("CANS Assessment Successfully Removed from the Database!",1,"C","Process Complete")
		                      $brmsg("The assessment will restart now.",2,"W")
							  Page = "0"
							  PromptNED = 1
							  {"lib_UACOMMON"}RemUMMonitor($regid,$scriptid)							  
                       case 2 rc = $dbread(02, $regid, cans_dstlist)
                              GetEvent(e.ser,e.ru,e.start,e.dur,e.loc)
		                      Page = "0"	
							  PromptNED = 2
                       case 3 $dblock()
                              rc = $dbread(02, $regid, cans_dstlist)	       
		                      rc = $dbremovedst(02, $regid, cans_dstlist)
		                      $brmsg("CANS Assessment Successfully Removed from the Database!",1,"C","Process Complete")
		                      $brmsg("The assessment will exit now.",2,"W")
							  PromptNED = 3
							  {"lib_UACOMMON"}RemUMMonitor($regid,$scriptid)
		                      return
                       case 4 PromptNED = 4
					          return
                       case 5 $brmsg("CANS Assessment Currently Being Entered by Another Staff Member!",1,"C","In Progress")
		                      $brmsg("The assessment will exit now.",2,"W")
							  PromptNED = 5
		                      return	
                       case !dp $clear(c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
                                Page = "0"
                      endselect    
	case other rc = $dbread(02, $regid, cans_dstlist)
	           GetEvent(e.ser,e.ru,e.start,e.dur,e.loc)	
              Page = "Authorize"
   case !dp $clear(c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
	         Page = "0"
   endselect
  else
   select {"lib_CANS"}PromptNewEditDel($regid)
    case 1 $dblock()
           rc = $dbread(02, $regid, c.cans.rec,c.cans.date)	
           rc = $dbremovedst(02, $regid, c.cans.rec,c.cans.date)
           $clear(c.cans.date,c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
		   $brmsg("CANS Assessment Successfully Removed from the Database!",1,"C","Process Complete")
		   $brmsg("The assessment will restart now.",2,"W")
		   Page = "0"
		   PromptNED = 1
    case 2 rc = $dbread(02, $regid, cans_dstlist)
           GetEvent(e.ser,e.ru,e.start,e.dur,e.loc)
		   Page = "0"
		   PromptNED = 2
    case 3 $dblock()
           rc = $dbread(02, $regid, cans_dstlist)	       
		   rc = $dbremovedst(02, $regid, cans_dstlist)
		   $brmsg("CANS Assessment Successfully Removed from the Database!",1,"C","Process Complete")
		   $brmsg("The assessment will exit now.",2,"W")
		   PromptNED = 3
		   return
    case 4 PromptNED = 4
	       return
    case 5 $brmsg("CANS Assessment Currently Being Entered by Another Staff Member!",1,"C","In Progress")
		   $brmsg("The assessment will exit now.",2,"W")
		   PromptNED = 5
		   return	
    case !dp $clear(c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
             Page = "0"
   endselect    
  endif
 else
  select {"lib_CANS"}PromptNewEditDel($regid)
   case 1 $dblock()
          rc = $dbread(02, $regid, c.cans.rec,c.cans.date)	
          rc = $dbremovedst(02, $regid, c.cans.rec,c.cans.date)
          $clear(c.cans.date,c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
	      $brmsg("CANS Assessment Successfully Removed from the Database!",1,"C","Process Complete")
	      $brmsg("The assessment will restart now.",2,"W")
          ClearPage1()
          ClearPage2()
          ClearPage3()
		  Page = "0"
		  PromptNED = 1
   case 2 rc = $dbread(02, $regid, cans_dstlist)
          GetEvent(e.ser,e.ru,e.start,e.dur,e.loc)
          Page = "0"
		  PromptNED = 2
   case 3 $dblock()
          rc = $dbread(02, $regid, cans_dstlist)	       
		  rc = $dbremovedst(02, $regid, cans_dstlist)
		  $brmsg("CANS Assessment Successfully Removed from the Database!",1,"C","Process Complete")
		  $brmsg("The assessment will exit now.",2,"W")
		  PromptNED = 3
		  return
   case 4 PromptNED = 4
          return
   case 5 $brmsg("CANS Assessment Currently Being Entered by Another Staff Member!",1,"C","In Progress")
		  $brmsg("The assessment will exit now.",2,"W")
		  PromptNED = 5
		  return
   case !dp $clear(c.cans.compd,c.cans.type,c.cans.staff,c.cans.canstype)
            Page = "0"
  endselect    
 endif
 
 do while 1 = 1
  select Page
   case "0" Page0()
            select $endbutton
			 case "SUBMIT" Page = "Validate0"
			 case other if {"lib_UACOMMON"}ConfirmExit() = "Y"
                         return
                        endif
			endselect
   case "1" Page1()
            select $endbutton
			 case "SUBMIT" Page = "Validate1"
			 case other Page = "0"
			endselect			
   case "2" Page2()
			select $endbutton
			 case "SUBMIT" Page = "Validate2"
			 case other Page = "1"
			endselect			
   case "3" Page3()  			
			select $endbutton
			 case "SUBMIT" Page = "Validate3"
			 case other Page = "2"
			endselect					
   case "4" Page4()
			select $endbutton
			 case "SUBMIT" Page = "Validate4"
			 case other select CanSkipPage3() 
					     case "Y" select CanSkipPage2()
								   case "Y" select CanSkipPage1()
								             case "Y" Page = "0"
											 case "N" Page = "1"
											endselect
								   case "N" Page = "2"
								  endselect
						 case "N" Page = "3"
						endselect
			endselect			  
   case "Validate0" select Validate0()
                     case 0 select CanSkipPage1()
					         case "Y" select CanSkipPage4()
							           case "Y" Page = "Report" 							 
									   case "N" Page = "4" 
									  endselect
							 case "N" Page = "1"
							endselect
					 case 1 Page = 0
					        {"lib_UACOMMON"}DisplayErrors(errors[])
                    endselect
   case "Validate1" select Validate1()
					 case 0 select CanSkipPage2()
					         case "Y" select CanSkipPage4()
							           case "Y" Page = "Report"
									   case "N" Page = "4"
									  endselect
					         case "N" Page = "2"
							endselect
					 case 1 Page = "1"
					        {"lib_UACOMMON"}DisplayErrors(errors[])
					endselect					 
   case "Validate2" select Validate2()
					 case 0 select CanSkipPage3()
					         case "Y" select CanSkipPage4()
							           case "Y" Page = "Report"
									   case "N" Page = "4"
									  endselect
					         case "N" Page = "3"
							endselect
					 case 1 Page = "2"
					        {"lib_UACOMMON"}DisplayErrors(errors[])
					endselect					
   case "Validate3" select Validate3()
					 case 0 Page = "4"
					 case 1 Page = "3"
					        {"lib_UACOMMON"}DisplayErrors(errors[])  
					endselect					
   case "Validate4" select Validate4() 
                     case 0 c.cans.rloc = RLOC()
                            if c.cans.type = "3" 'and c.cans.disreas != "9"
                             $clear(c.cans.rloc,c.cans.aloc,c.cans.dloc)
                            endif									 					 
					        select c.cans.rloc
							 case "100" c.cans.aloc = c.cans.rloc
							            Page = "Report"
							 case other Page = "SAL"
						    endselect																		         
					 case 1 Page = "4"
					        {"lib_UACOMMON"}DisplayErrors(errors[])
					endselect 				
   case "ValidateReport" select ValidateReport()
                          case 0 if SaveData() = 0
					             Page = "Exit"
								 {"lib_UACOMMON"}AddUMMonitor($regid,$scriptid)
								endif 
                          case 1 Page = "Report"
						         {"lib_UACOMMON"}DisplayErrors(errors[])
                         endselect			
   case "ValidateALOC" select ValidateALOC()
                        case 0 Page = "Report"
						case 1 Page = "Authorize"
					           {"lib_UACOMMON"}DisplayErrors(errors[])
					   endselect
   case "Report"    c.cans.rloc = RLOC()
                    if c.cans.type = "3" 'and c.cans.disreas != "9"
                     $clear(c.cans.rloc,c.cans.aloc,c.cans.dloc)
                    endif									 
                    Report(page)
					select $endbutton
					 case "SUBMIT" if UM_StaffYN = "Y"
								    if (c.cans.staff = $operstaffid and c.cans.staff dp)
									 Page = "ValidateReport"
									else
									 Page = "Exit"
									endif
								   else
								    Page = "ValidateReport"
								   endif								   
					 case "CANCEL" if UM_StaffYN = "Y" and (c.cans.staff != $operstaffid and c.cans.staff dp)
						            Page = "Authorize"
								   else
						            if (c.cans.type = "1" or c.cans.type = "12") and c.cans.isn !dp
								     Page = "SAL"
								    else
								     select CanSkipPage4()
									  case "Y" select CanSkipPage3()
									             case "Y" select CanSkipPage2()
											               case "Y" select CanSkipPage1()
														             case "Y" Page = "0"
																     case "N" Page = "1"
																    endselect
														   case "N" Page = "2"
														  endselect
											     case "N" Page = "3"
											    endselect
									   case "N" Page = "4"
									 endselect
								    endif 
								   endif 
					 case other if SaveData() = 0
								 Page = "Exit"
								 {"lib_UACOMMON"}RemUMMonitor($regid,$scriptid)
 	                             {"lib_UACOMMON"}AddBatch($regid,$scriptid)	   								 
								endif 
					endselect
   case "Authorize" c.cans.rloc = RLOC()
                    if c.cans.type = "3" 'and c.cans.disreas != "9"
                     $clear(c.cans.rloc,c.cans.aloc,c.cans.dloc)
                    endif									 
                    Report(page)
                    select $endbutton
					 case "SUBMIT"  if (c.cans.aloc dp and c.cans.aloc != c.cans.rloc) and c.cans.loc_dev !dp
                                     $brmsg("Please select the reason for deviation from the Recommended LOC!",1,"W","Deviation Reason") 
									 Page = "Authorize"
					                else									
					                 Page = "ValidateALOC"
                                    endif
					 case "CANCEL" if {"lib_UACOMMON"}ConfirmExit() = "Y"   
                                    return
                                   endif
					endselect
   case "SAL" if SkipSer = "N"
               select c.cans.type
                case "1" if c.cans.isn !dp
			              e.ser = AssessmentSer
						  {"lib_UAEVENTS"}event(e.ser, e.ru, e.start, e.dur, e.loc, addsal)
                          select $endbutton
						   case "SUBMIT" select addsal
						                  case "YES" {"lib_UAEVENTS"}overlap(errors[],e.ser,e.start,e.dur,c.cans.date,$operstaffid)
                                                     if $maxarray(errors[]) = 0
						                              Page = "Report"
						                             else
						                              {"lib_UACOMMON"}DisplayErrors(errors[])
													  $clear(errors[])
						                             endif
										  case "NO" $clear(e.ser,e.ru,e.start,e.dur,e.loc)
												    Page = "4"
										  case !dp $clear(e.ser,e.ru,e.start,e.dur,e.loc)
			                                       Page = "4"
										 endselect
						   case "CANCEL" Page = "4"
						  endselect
						 else 
						  Page = "Report"
						 endif 
			    case other Page = "Report"
               endselect
			  else
			   select $endbutton
			    case "SUBMIT" Page = "Report"
				case "CANCEL" Page = "4"
			   endselect
			  endif
			   
   case "Exit" return					
  endselect 
 enddo
end CANS35

function Report(mode) is null
 mode     is x
 if (StaffAssign_YN = "Y" and UM_StaffYN = "Y") and (c.cans.staff != $operstaffid and c.cans.staff dp)
  UM_StaffYN = "N"
 endif 

 if UM_StaffYN = "Y" and (c.cans.staff != $operstaffid and c.cans.staff dp)
  select mode
   case "Report"    $submitopt("off", "")
   case "Authorize" $submitopt("off", "Authorize")
  endselect
 else
  $submitopt("off", "Send to UM")
 endif
 $cancelopt("off", "Back")
 $form($funcname)
  {"lib_UACOMMON"}ClientPageHeader($regid)
  
  if c.cans.isn dp
   {"lib_UAEVENTS"}report(e.ser, e.ru, e.start, e.dur, e.loc)
  endif
  
  $style("siginfotag")
  $br()ReportHdr()
  OtherQuestionRpt()
  ChildRiskRpt()
  ChildRiskFacRpt()
  BehEmoRpt()
  LifeDomainRpt()
  CareGiveRpt()
  ChildStrRpt()
  CultureRpt()
  Page4Rpt()
  select mode
   case "Report"  if UM_StaffYN = "Y" and (c.cans.staff != $operstaffid and c.cans.staff dp)
                   $br()StaffComments()
				   $br()ALOCRpt()
				  else 
				   $br()RLOCRpt()
				  endif
   case "Authorize" $br()StaffComments()
                    $br()ALOC()
  endselect
 $sendform($funcname)
end Report

function SaveData() is i
 mode is x
 
 bad_char_index is i
 bad_char[] is x
 bad_char[1] = "<"
 bad_char[2] = ">"
 bad_char[3] = "&"
 
 NewUID is n
 
 c.cans.age = {"lib_UACOMMON"}ClientAge($regid, c.cans.date)
 if c.cans.compd !dp
  mode = "ADD"
 else
  mode = "UPDATE"  
 endif
 if PromptNED = 2
  mode = "UPDATE"  
 endif 
 $dblock()
 SaveData = $dbpoint(02, $regid, c.cans.rec) 
 if c.cans.compd dp
  c.cans.snapid = {"l_snapLibSC"}sn_GetSnapID()	                           
 endif 
 if c.cans.resother1 dp
  c.cans.resother1 = $seg(c.cans.resother1,1,44)
  c.cans.resother2 = $seg(c.cans.resother1,45,56)
 else
  $clear(c.cans.resother1,c.cans.resother2)
 endif
 if c.cans.devjust dp
  c.cans.devR1 = $seg(c.cans.devjust,1,63)
  c.cans.devR2 = $seg(c.cans.devjust,64,63)
  c.cans.devR3 = $seg(c.cans.devjust,127,63)
  c.cans.devR4 = $seg(c.cans.devjust,190,63)
  c.cans.devR5 = $seg(c.cans.devjust,253,3)
 else
  $clear(c.cans.devR1,c.cans.devR2,c.cans.devR3,c.cans.devR4,c.cans.devR5)
 endif
 if c.cans.aloc = "100"
  $clear(c.cans.intref,c.cans.intrefoth)
 endif  
'replace characters that could cause parsing errors in the batch, textbox/block fields
'Not sure what to replace them with yet, so for now just an underscore
 if c.cans.resother1 dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.resother1 = $replace(bad_char[bad_char_index],"_",c.cans.resother1)
  enddo 
 endif
 if c.cans.resother2 dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.resother2 = $replace(bad_char[bad_char_index],"_",c.cans.resother2)
  enddo
 endif
 if c.cans.intrefoth dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.intrefoth = $replace(bad_char[bad_char_index],"_",c.cans.intrefoth)
  enddo
 endif
 if c.cans.disoth dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.disoth = $replace(bad_char[bad_char_index],"_",c.cans.disoth)
  enddo
 endif
 if c.cans.acomment dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.acomment = $replace(bad_char[bad_char_index],"_",c.cans.acomment)
  enddo
 endif
 if c.cans.comment dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.comment = $replace(bad_char[bad_char_index],"_",c.cans.comment)
  enddo
 endif
 if c.cans.devjust dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.devjust = $replace(bad_char[bad_char_index],"_",c.cans.devjust)
  enddo
 endif
 if c.cans.devoth dp
  bad_char_index = 0
  do while bad_char_index++ < $maxarray(bad_char[])
   c.cans.devoth = $replace(bad_char[bad_char_index],"_",c.cans.devoth)
  enddo 
 endif
 select mode
  case "ADD" select c.cans.type
              case "1" if c.cans.isn !dp
			            c.cans.isn = SaveEvent()
					   endif	
              case "12" if c.cans.isn !dp
			             c.cans.isn = SaveEvent()
					    endif	
              case other
             endselect
			 c.cans.rec[effd] = c.cans.date
			 NewUID = c.cans.rec[uid]
			 c.cans.canstype = "2"
          $clear(c.cans.aloc)
             SaveData = $dbadddst(02, $regid, cans_dstlist)
  case "UPDATE" c.cans.rec[effd] = c.cans.date
               if (c.cans.dloc = c.cans.rloc) and (c.cans.dloc = c.cans.aloc)
                 $clear(c.cans.dloc)
				endif 
				if c.cans.dloc dp and c.cans.dloc = c.cans.rloc
				 $clear(c.cans.dloc)
				endif
				if c.cans.compd !dp and c.cans.aloc = "100"
				 $clear(c.cans.aloc)
				endif				 
 if c.cans.type != "1" and c.cans.type != "2" then
   $clear(c.cans.bipsq1,c.cans.bipsq2)
 endif
                SaveData = $dbupdate(02, $regid, 
c.cans.rec,c.cans.staff,c.cans.ver,c.cans.date,c.cans.age,c.cans.aloc,c.cans.rloc,c.cans.dloc,c.cans.compd,c.cans.type,
c.cans.school3m,c.cans.arrest,c.cans.grade,c.cans.restype,c.cans.resother1,c.cans.resother2,
c.cans.sped,c.cans.extdrev,c.cans.foster,c.cans.riskplc,c.cans.tcoommi,
c.cans.disdt,c.cans.disreas,c.cans.disref,c.cans.disoth,
c.cans.intref,c.cans.intrefoth,
c.cans.loc_dev,c.cans.devoth,c.cans.devr1,c.cans.devr2,c.cans.devr2,c.cans.devr3,c.cans.devr4,c.cans.devr5,
c.cans.alocstaff,c.cans.alocdate,c.cans.alocedate,c.cans.fairhear,
c.cans.snapid,
c.cans.isn,
c.cans.commdate,
c.cans.comment,c.cans.acomment,
c.cans.devjust,
c.cans.canstype,
'c.cans.resv6,c.cans.resv7,c.cans.resv8,c.cans.resv9,
c.cans.ld.family,c.cans.ld.livsit,c.cans.ld.preday,c.cans.ld.socFun,c.cans.ld.recret,c.cans.ld.develp,c.cans.ld.motor,c.cans.ld.commun,c.cans.ld.medicl,c.cans.ld.physcl,c.cans.ld.sleep ,c.cans.ld.relper, 
c.cans.cs.family,c.cans.cs.extfam,c.cans.cs.intper,c.cans.cs.adapt,c.cans.cs.persis,c.cans.cs.curios,
c.cans.ac.langua,c.cans.ac.identy,c.cans.ac.ritual,c.cans.ac.culstr,c.cans.ac.culdif,
c.cans.cg.super,c.cans.cg.involv,c.cans.cg.knoldg,c.cans.cg.organz,c.cans.cg.socres,c.cans.cg.ressbl,c.cans.cg.physcl,c.cans.cg.menhth,c.cans.cg.subabs,c.cans.cg.develp,c.cans.cg.chldcr,c.cans.cg.miltra,c.cans.cg.famsts,c.cans.cg.safety,
c.cans.cg.empath,c.cans.cg.marvio,
c.cans.cb.attach,c.cans.cb.regula,c.cans.cb.fthriv,c.cans.cb.depres,c.cans.cb.anxity,c.cans.cb.atypic,c.cans.cb.implsv,c.cans.cb.oppdef,c.cans.cb.adjtrm,
c.cans.cr.sfharm,c.cans.cr.aggbeh,c.cans.cr.socbeh,
c.cans.cf.birthw,c.cans.cf.pica,c.cans.cf.prenat,c.cans.cf.labdel,c.cans.cf.subexp,c.cans.cf.psprob,c.cans.cf.matava,c.cans.cf.abuse,
c.cans.sc.prequa,c.cans.sc.pbehav,c.cans.sc.pachie,c.cans.sc.patten,
c.cans.dv.cognit,c.cans.dv.selfcr,
c.cans.fc.selfcr,c.cans.fc.culstr,c.cans.fc.empedu,c.cans.fc.eduatt,c.cans.fc.legal,c.cans.fc.motive,c.cans.fc.finres,c.cans.fc.transp,
c.cans.tr.sexabs,c.cans.tr.phyabs,c.cans.tr.emoabs,c.cans.tr.medtrm,c.cans.tr.natdis,c.cans.tr.wtofam,c.cans.tr.wtocom,c.cans.tr.wcrime,c.cans.tr.waraff,c.cans.tr.teraff,c.cans.tr.emclos,c.cans.tr.freq ,c.cans.tr.durat,c.cans.tr.force,c.cans.tr.react,
c.cans.ad.affreg,c.cans.ad.reexp,c.cans.ad.avoid,c.cans.ad.incaro,c.cans.ad.numres,c.cans.ad.timb4t,
c.cans.rg.eating,c.cans.rg.elim,c.cans.rg.sensor,c.cans.rg.emot,
c.cans.bipsq1,c.cans.bipsq2,
c.cans.caredt)				
 endselect
  select SaveData
   case 0 $brmsg("CANS Assessment Successfully saved to Database!",1,"W","Process Complete")
   case 4 $brmsg("Client is currently locked by another process, please wait a moment and retry",1,"W","Please Retry") 
   case other $brmsg(`"Error Saving Data,  RC=" + SaveData`,1,"W","Error Saving")
  endselect
end SaveData

'Life Domain
function LifeDomain() is null
 bgcolor = "white"
 if $find(ld_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Life Domain",,"datatag")
  LDScoring()
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
    $col("center",,"10%")$text("NA")
	radio_index = -1
	do while radio_index++ < 3
	 $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
    do while radio_index++ < 6
     $col()$tag("<hr/>")
    enddo
   $row(,row_color1)
    $col()$text(q_text_ld_family)
    $col("center")$radio(c.cans.ld.family,,"9")
    radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.family,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_ld_livsit)
    $col()
    radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.livsit,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_ld_preday)$text("{sup}3{/sup}")
    $col()
    $col("center")$radio(c.cans.ld.preday,,"0")
    radio_index = 0
	do while radio_index++ < 3
     $col("center",,,,,col_color_multi)$radio(c.cans.ld.preday,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_ld_socFun)
    $col()
    radio_index = -1
    do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.socFun,,$castx(radio_index))
    enddo   	
   $row(,row_color1)
    $col()$text(q_text_ld_recret)
    $col()
    radio_index = -1
    do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.recret,,$castx(radio_index))
    enddo   		
   $row(,row_color2)
    $col()$text(q_text_ld_develp)$text("{sup}4{/sup}")
    $col()
    $col("center")$radio(c.cans.ld.develp,,"0")
    radio_index = 0
    do while radio_index++ < 3
     $col("center",,,,,col_color_multi)$radio(c.cans.ld.develp,,$castx(radio_index))  
    enddo   			
   $row(,row_color1)
    $col()$text(q_text_ld_motor)
    $col()
    radio_index = -1
    do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.motor,,$castx(radio_index))
    enddo 	  
   $row(,row_color2)
    $col()$text(q_text_ld_commun)
    $col()
    radio_index = -1
    do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.commun,,$castx(radio_index))
    enddo 	  	
   $row(,row_color1)
    $col()$text(q_text_ld_medicl)
    $col()
    radio_index = -1
    do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.medicl,,$castx(radio_index))
    enddo 	  		
   $row(,row_color2)
    $col()$text(q_text_ld_physcl)
    $col()
    radio_index = -1
    do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.physcl,,$castx(radio_index))
    enddo 	  			
   $row(,row_color1)
    $col()$text(q_text_ld_sleep) 	
    $col("center")$radio(c.cans.ld.sleep,,"9")
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.sleep,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_ld_relper)
    $col()
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ld.relper,,$castx(radio_index))
	enddo
  $endtable($funcname)
 $endfieldset()
end LifeDomain

function CareGive() is null
 bgcolor = "white"
 if $find(cg_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Caregiver Strengths and Needs",,"datatag")
  CareGiverScoring()
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
    radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo
   $row(,row_color1)
    $col()$text(q_text_cg_super)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.super,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_involv)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.involv,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_knoldg)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.knoldg,,$castx(radio_index))
	enddo	 
   $row(,row_color2)
    $col()$text(q_text_cg_empath)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.empath,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_organz)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.organz,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_socres)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.socres,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_ressbl)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.ressbl,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_physcl)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.physcl,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_menhth)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.menhth,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_subabs)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.subabs,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_develp) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.develp,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_chldcr)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.chldcr,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_miltra)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.miltra,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_famsts)$text("{sup}5{/sup}")
    $col("center")$radio(c.cans.cg.famsts,,"0")
	radio_index = 0
	do while radio_index++ < 3
     $col("center",,,,,col_color_multi)$radio(c.cans.cg.famsts,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cg_safety)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.safety,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cg_marvio)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cg.marvio,,$castx(radio_index))
	enddo	
  $endtable($funcname)
 $endfieldset()
end CareGive

'Child Strengths
function ChildStrength() is null
 bgcolor = "white"
 if $find(cs_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Child Strengths",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col(,,"50%")$text("0 = centerpiece","hdrdata")
    $col()$text("1 = useful","hdrdata")
   $row()
    $col()$text("2 = identified","hdrdata")
    $col()$text("3 = not yet identified","hdrdata")
   $row()
    $col("center",,,"2") $tag("<hr/>")
  $endtable($funcname)
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cs_family)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cs.family,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_cs_extfam) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cs.extfam,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cs_intper) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cs.intper,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_cs_adapt) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cs.adapt,,$castx(radio_index))
	enddo		
   $row(,row_color1)
    $col()$text(q_text_cs_persis) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cs.persis,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_cs_curios)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cs.curios,,$castx(radio_index))
	enddo		 
  $endtable($funcname)
 $endfieldset()
end ChildStrength

'Child Behavioral and Emotional Needs
function ChildBehave() is null
 bgcolor = "white"
 if $find(cb_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Child Behavioral and Emotional Needs",,"datatag")
  CBScoring()
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
    $col("center",,"10%")$text("NA")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
 	do while radio_index++ < 6
     $col()$tag("<hr/>")
	enddo
   $row(,row_color1)
    $col()$text(q_text_cb_attach)
    $col()
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.cb.attach,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cb_regula)$text("{sup}1{/sup}") 
	$col()
	$col("center")$radio(c.cans.cb.regula,,"0")
	radio_index = 0
	do while radio_index++ < 3
     $col("center",,,,,col_color_multi)$radio(c.cans.cb.regula,,$castx(radio_index))
	enddo	
   $row(,row_color1) 
	$col()$text(q_text_cb_fthriv)
	$col()
	radio_index = -1
 	do while radio_index++ < 3
  	 $col("center")$radio(c.cans.cb.fthriv,,$castx(radio_index))
	enddo			
   $row(,row_color2)
    $col()$text(q_text_cb_depres)
    $col()
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.cb.depres,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cb_anxity)
    $col()
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.cb.anxity,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_cb_atypic)
    $col()
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.cb.atypic,,$castx(radio_index))
	enddo		
   $row(,row_color1)
    $col()$text(q_text_cb_implsv) 
	$col("center")$radio(c.cans.cb.implsv,,"9")
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.cb.implsv,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_cb_oppdef)
    $col("center")$radio(c.cans.cb.oppdef,,"9")
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cb.oppdef,,$castx(radio_index))
	enddo		
   $row(,row_color1)
    $col()$text(q_text_cb_adjtrm)$text("{sup}2{/sup}")
    $col()
	$col("center")$radio(c.cans.cb.adjtrm,,"0")
	radio_index = 0
	do while radio_index++ < 3
     $col("center",,,,,col_color_multi)$radio(c.cans.cb.adjtrm,,$castx(radio_index))
	enddo		
  $endtable($funcname)
 $endfieldset()
end ChildBehave

'Culture
function Culture() is null
 bgcolor = "white"
 if $find(ac_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Culture",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col(,,"50%")$text("0 = no evidence","hdrdata")
    $col()$text("1 = minimal needs","hdrdata")
   $row()
    $col()$text("2 = moderate needs","hdrdata")
    $col()$text("3 = severe needs","hdrdata")
   $row()
    $col("center",,,"2") $tag("<hr/>")
  $endtable($funcname)
 $table($funcname,,`table_wbgcolor`)
  $row()
   $col("center",,"50%")
   radio_index = -1
   do while radio_index++ < 3
    $col("center",,"10%")$text(radio_index)
   enddo   
  $row()
   radio_index = 0
   do while radio_index++ < 5
    $col()$tag("<hr/>")
   enddo    
  $row(,row_color1)
   $col()$text(q_text_ac_langua)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.ac.langua,,$castx(radio_index))
   enddo   
  $row(,row_color2)
   $col()$text(q_text_ac_identy) 
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.ac.identy,,$castx(radio_index))
   enddo      
  $row(,row_color1)
   $col()$text(q_text_ac_ritual)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.ac.ritual,,$castx(radio_index))
   enddo      
  $row(,row_color2)
   $col()$text(q_text_ac_culstr)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.ac.culstr,,$castx(radio_index))
   enddo      
  $row(,row_color1)
   $col()$text(q_text_ac_culdif)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.ac.culdif,,$castx(radio_index))
   enddo        
  $endtable($funcname)
 $endfieldset()
end Culture

'Child Risk Behaviors
function ChildRisk() is null
 bgcolor = "white"
 if $find(cr_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Child Risk Behaviors",,"datatag")
  ChildRiskScoring()
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
    $col("center",,"10%")$text("NA")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo	
   $row()
    radio_index = 0
	do while radio_index++ < 6
     $col()$tag("<hr/>")
	enddo     
   $row(,row_color1)
    $col()$text(q_text_cr_sfharm)
	$col("center")
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cr.sfharm,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cr_aggbeh)
	$col("center") 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cr.aggbeh,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cr_socbeh)
    $col("center")$radio(c.cans.cr.socbeh,,"9")
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cr.socbeh,,$castx(radio_index))
	enddo	
  $endtable($funcname)
 $endfieldset()
end ChildRisk

'School Module
function School() is null
 bgcolor = "white" 
 if $find(sc_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("School",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo	
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo  
   $row(,row_color3)
    $col()$text(q_text_sc_prequa)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.sc.prequa,,$castx(radio_index))
	enddo	 
   $row(,row_color2)
    $col()$text(q_text_sc_pbehav)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.sc.pbehav,,$castx(radio_index))
	enddo	
   $row(,row_color3)
    $col()$text(q_text_sc_pachie) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.sc.pachie,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_sc_patten)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.sc.patten,,$castx(radio_index))
	enddo	
  $endtable($funcname)
 $endfieldset()
end School

'Developmental Needs
function DevNeeds() is null
 bgcolor = "white"
 if $find(dv_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Developmental Needs",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo	
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo  
   $row(,row_color3)
    $col()$text(q_text_dv_cognit)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.dv.cognit,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_dv_selfcr)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.dv.selfcr,,$castx(radio_index))
	enddo	
  $endtable($funcname)
 $endfieldset()
end DevNeeds

'Family Caregiver Module
function FamilyCareGive() is null
 bgcolor = "white"
 if $find(fcg_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Family Caregiver",,"datatag")
  $table($funcname,,`table_wbgcolor`)
  $row()
   $col("center",,"50%")
   radio_index = -1
   do while radio_index++ < 3
    $col("center",,"10%")$text(radio_index)
   enddo   
  $row()
   radio_index = 0
   do while radio_index++ < 5
    $col()$tag("<hr/>")
   enddo 
  $row(,row_color3)
   $col()$text(q_text_fc_selfcr)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.selfcr,,$castx(radio_index))
   enddo   
   $row(,row_color2)
   $col()$text(q_text_fc_culstr) 
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.culstr,,$castx(radio_index))
   enddo   
    $row(,row_color3)
   $col()$text(q_text_fc_empedu)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.empedu,,$castx(radio_index))
   enddo   
     $row(,row_color2)
   $col()$text(q_text_fc_eduatt) 
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.eduatt,,$castx(radio_index))
   enddo   
  $row(,row_color3)
   $col()$text(q_text_fc_legal)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.legal,,$castx(radio_index))
   enddo   
   $row(,row_color2)
   $col()$text(q_text_fc_motive) 
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.motive,,$castx(radio_index))
   enddo   
    $row(,row_color3)
   $col()$text(q_text_fc_finres)
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.finres,,$castx(radio_index))
   enddo   
  $row(,row_color2)
   $col()$text(q_text_fc_transp) 
   radio_index = -1
   do while radio_index++ < 3
    $col("center")$radio(c.cans.fc.transp,,$castx(radio_index))
   enddo   
 $endtable($funcname)
$endfieldset()
end FamilyCareGive

'Trauma Module
function trauma() is null
 bgcolor = "white"
 if $find(tr_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Trauma",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo  
   $row(,row_color3)
    $col()$text(q_text_tr_sexabs)
    $col("center")$radio(c.cans.tr.sexabs,,"0")
	radio_index = 0
	do while radio_index++ < 3
     $col("center",,,,,col_color_multi)$radio(c.cans.tr.sexabs,,$castx(radio_index))
	enddo	
  $endtable($funcname)
  $table($funcname,,table_nobgcolor)
   $row(,row_color2)
    $col(,,"50%")$text(q_text_tr_phyabs) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$radio(c.cans.tr.phyabs,,$castx(radio_index))
	enddo	
   $row(,row_color3)
    $col()$text(q_text_tr_emoabs)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.emoabs,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_tr_medtrm) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.medtrm,,$castx(radio_index))
	enddo		
   $row(,row_color3)
    $col()$text(q_text_tr_natdis)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.natdis,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_tr_wtofam) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.wtofam,,$castx(radio_index))
	enddo		
   $row(,row_color3)
    $col()$text(q_text_tr_wtocom)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.wtocom,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_tr_wcrime)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.wcrime,,$castx(radio_index))
	enddo		
   $row(,row_color3)
    $col()$text(q_text_tr_waraff) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.waraff,,$castx(radio_index))
	enddo		
   $row(,row_color2)
    $col()$text(q_text_tr_teraff)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.teraff,,$castx(radio_index))
	enddo		
  $endtable($funcname)
 $endfieldset()
end trauma

function sexab1() is null
 bgcolor = "white" 
 if $find(sxab_errortxt,errors[],,"F") > 0
  bgcolor = "red" 
 endif 
 $fieldset("Trauma Module Continued",,"datatag")
  CBScoring() 
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo    
   $row(,row_color3)
    $col()$text(q_text_tr_emclos)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.emclos,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_tr_freq)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.freq,,$castx(radio_index))
	enddo
   $row(,row_color3)
    $col()$text(q_text_tr_durat) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.durat,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_tr_force)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.force,,$castx(radio_index))
	enddo
   $row(,row_color3)
    $col()$text(q_text_tr_react) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.tr.react,,$castx(radio_index))
	enddo   	
  $endtable($funcname)
 $endfieldset() 
end sexab1

'Adjustment------------------------------------
function adjust() is null
 bgcolor = "white"
 if $find(adj_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Adjustment",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo  
   $row(,row_color3)
    $col()$text(q_text_ad_affreg)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ad.affreg,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_ad_reexp) 
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ad.reexp,,$castx(radio_index))
	enddo	
   $row(,row_color3)
    $col()$text(q_text_ad_avoid)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ad.avoid,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_ad_incaro)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ad.incaro,,$castx(radio_index))
	enddo	
   $row(,row_color3)
    $col()$text(q_text_ad_numres)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ad.numres,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_ad_timb4t)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.ad.timb4t,,$castx(radio_index))
	enddo	
  $endtable($funcname)
 $endfieldset()
end adjust                                   
                                                             
'Life Domain Report 
function LifeDomainRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("Life Domain Functioning","datatag")
   $row(,row_color2)
    $col(,,"40%")$text(q_text_ld_family)
    $col("center",,"10%")$text(c.cans.ld.family)
    $col(,,"50%")
   $row()
    $col()$text(q_text_ld_livsit)
    $col("center")$text(c.cans.ld.livsit)
    $col()
   $row()
    $col()$text(q_text_ld_preday)$text("{sup}3{/sup}")
    $col("center")$text(c.cans.ld.preday)
	 if $num(c.cans.ld.preday) > 0
	  $col()SchoolRpt()
	 else
	  $col()
	 endif 
   $row()
    $col(,,"40%")$text(q_text_ld_socFun)
    $col("center",,"10%")$text(c.cans.ld.socFun)
    $col(,,"50%")
   $row()
    $col()$text(q_text_ld_recret)
    $col("center")$text(c.cans.ld.recret)
    $col()
   $row()
    $col()$text(q_text_ld_develp)$text("{sup}4{/sup}")
    $col("center")$text(c.cans.ld.develp)
	 if $num(c.cans.ld.develp) > 0
	  $col()DevNeedsRpt()
	 else
	  $col()
	 endif 
   $row()
    $col()$text(q_text_ld_motor)
    $col("center")$text(c.cans.ld.motor)
    $col()
   $row()
    $col()$text(q_text_ld_commun)
    $col("center")$text(c.cans.ld.commun)
    $col()
   $row()
    $col()$text(q_text_ld_medicl)
    $col("center")$text(c.cans.ld.medicl)
    $col()
   $row()
    $col()$text(q_text_ld_physcl)
    $col("center")$text(c.cans.ld.physcl)
    $col()    
   $row()
    $col()$text(q_text_ld_sleep) 
    $col("center")$text(c.cans.ld.sleep)
    $col()
   $row()
    $col()$text(q_text_ld_relper) 
    $col("center")$text(c.cans.ld.relper)
    $col()     
  $endtable($funcname)
 endif
end LifeDomainRpt

'School Report
function SchoolRpt() is null
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"2")$text("School Module", "datatag")
  $row(,row_color2)
   $col(,,"50%")$text(q_text_sc_prequa)
   $col("center")$text(c.cans.sc.prequa)
  $row()
   $col()$text(q_text_sc_pbehav) 
   $col("center")$text(c.cans.sc.pbehav)
  $row()
   $col()$text(q_text_sc_pachie)
   $col("center")$text(c.cans.sc.pachie)
  $row()
   $col()$text(q_text_sc_patten)
   $col("center")$text(c.cans.sc.patten)
 $endtable($funcname)
end SchoolRpt

'Development Report
function DevNeedsRpt() is null
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"2")$text("Developmental Needs Module", "datatag")
  $row(,row_color2)
   $col(,,"50%")$text(q_text_dv_cognit)
   $col("center")$text(c.cans.dv.cognit)
  $row()
   $col()$text(q_text_dv_selfcr)
   $col("center")$text(c.cans.dv.selfcr)
 $endtable($funcname)
end DevNeedsRpt

'Child Risk Report
function ChildRiskRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "11" or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("Child Risk Behaviors","datatag")
   $row(,row_color2)
    $col(,,"40%")$text(q_text_cr_sfharm)
    $col("center",,"10%")$text(c.cans.cr.sfharm)
    $col(,,"50%")                     
   if c.cans.cr.aggbeh dp
    $row()
     $col()$text(q_text_cr_aggbeh )
     $col("center")$text(c.cans.cr.aggbeh)
     $col()                          
   endif
   if c.cans.cr.socbeh dp
    $row()
     $col()$text(q_text_cr_socbeh)
     $col("center")$text(c.cans.cr.socbeh)
     $col()                          
   endif
  $endtable($funcname)
 endif
end ChildRiskRpt

'Emotional Behaviroal Needs Report
function BehEmoRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("Emotional Behavioral Needs","datatag")
   $row(,row_color2)
    $col(,,"40%")$text(q_text_cb_attach)
    $col("center",,"10%")$text(c.cans.cb.attach)
    $col(,,"50%")                               
   $row()                                      
    $col()$text(q_text_cb_regula)$text("{sup}1{/sup}")
    $col("center")$text(c.cans.cb.regula)
         if $num(c.cans.cb.regula) > 0
		  $col()RegulaRpt()
		 endif
    $col()                                        
   $row()                                      
    $col()$text(q_text_cb_fthriv)
    $col("center")$text(c.cans.cb.fthriv)
    $col()                                     
   $row()                                      
    $col()$text(q_text_cb_depres)
    $col("center")$text(c.cans.cb.depres)
    $col()                                      
   $row()                                      
    $col()$text(q_text_cb_anxity)
    $col("center")$text(c.cans.cb.anxity)
    $col()
   $row()                                      
    $col()$text(q_text_cb_atypic)
    $col("center")$text(c.cans.cb.atypic)
    $col()                                      
   $row()                                      
    $col()$text(q_text_cb_implsv)
    $col("center")$text(c.cans.cb.implsv)
    $col()                                       
   $row()                                      
    $col()$text(q_text_cb_oppdef)
    $col("center")$text(c.cans.cb.oppdef)
    $col()                                      
   $row()                                      
    $col()$text(q_text_cb_adjtrm)$text("{sup}2{/sup}")
    $col("center")$text(c.cans.cb.adjtrm)
	    if $num(c.cans.cb.adjtrm) > 0
 	     $col() TraumaRpt() $br() AdjustRpt()
	    else
		 $col()
	    endif
    $col()                                                
  $endtable($funcname)
 endif
end BehEmoRpt

'Trauma Module Report
function TraumaRpt() is null
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"2")$text("Trauma Module", "datatag")
  $row(,row_color2)
   $col(,,"50%")$text($left(q_text_tr_sexabs, 12))
   $col("center")$text(c.cans.tr.sexabs)
	   if $num(c.cans.tr.sexabs) > 0
		$row()                                       
		 $col("right")$text(q_text_tr_emclos) 
		 $col("center")$text(c.cans.tr.emclos)
		$row()                                       
		 $col("right")$text(q_text_tr_freq)
		 $col("center")$text(c.cans.tr.freq)
		$row()                                       
		 $col("right")$text(q_text_tr_durat)
		 $col("center")$text(c.cans.tr.durat)
		$row()                                       
		 $col("right")$text(q_text_tr_force) 
		 $col("center")$text(c.cans.tr.force)
		$row()                                       
		 $col("right")$text(q_text_tr_react)
		 $col("center")$text(c.cans.tr.react)
	   endif
  $row()                                       
   $col()$text(q_text_tr_phyabs)
   $col("center")$text(c.cans.tr.phyabs)
  $row()                                       
   $col()$text(q_text_tr_emoabs) 
   $col("center")$text(c.cans.tr.emoabs)
  $row()                                       
   $col()$text(q_text_tr_medtrm)
   $col("center")$text(c.cans.tr.medtrm)
  $row()                                       
   $col()$text(q_text_tr_natdis)
   $col("center")$text(c.cans.tr.natdis)
  $row()                                       
   $col()$text(q_text_tr_wtofam) 
   $col("center")$text(c.cans.tr.wtofam)
  $row()                                       
   $col()$text(q_text_tr_wtocom)
   $col("center")$text(c.cans.tr.wtocom)
  $row()                                       
   $col()$text(q_text_tr_wcrime)
   $col("center")$text(c.cans.tr.wcrime)
  $row()                                       
   $col()$text(q_text_tr_waraff) 
   $col("center")$text(c.cans.tr.waraff)
  $row()                                       
   $col()$text(q_text_tr_teraff)
   $col("center")$text(c.cans.tr.teraff)
 $endtable($funcname)
end TraumaRpt

'Adjustment Module Report
function AdjustRpt() is null
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"2")$text("Adjustment Module", "datatag")
  $row(,row_color2)
   $col(,,"50%")$text(q_text_ad_affreg)
   $col("center")$text(c.cans.ad.affreg)
  $row()                                       
   $col()$text(q_text_ad_reexp) 
   $col("center")$text(c.cans.ad.reexp)
  $row()                                      
   $col()$text(q_text_ad_avoid)
   $col("center")$text(c.cans.ad.avoid)
  $row()                                       
   $col()$text(q_text_ad_incaro)
   $col("center")$text(c.cans.ad.incaro)
  $row()
   $col()$text(q_text_ad_numres)
   $col("center")$text(c.cans.ad.numres)   
  $row()                                       
   $col()$text(q_text_ad_timb4t)
   $col("center")$text(c.cans.ad.timb4t)
 $endtable($funcname)
end AdjustRpt

'CARE Give Giver Strengths & Needs Report
function CareGiveRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("Caregiver Strengths and Needs","datatag")
    $row(,row_color2)
     $col(,,"40%")$text(q_text_cg_super)
     $col("center",,"10%")$text(c.cans.cg.super)
     $col()                               
    $row()                                      
     $col()$text(q_text_cg_involv)
     $col("center")$text(c.cans.cg.involv)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_knoldg)
     $col("center")$text(c.cans.cg.knoldg)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_empath)
     $col("center")$text(c.cans.cg.empath)
     $col()  
    $row()                                      
     $col()$text(q_text_cg_organz)
     $col("center")$text(c.cans.cg.organz)
     $col()                               
    $row()                                      
     $col()$text(q_text_cg_socres)
     $col("center")$text(c.cans.cg.socres)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_ressbl)
     $col("center")$text(c.cans.cg.ressbl)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_physcl)
     $col("center")$text(c.cans.cg.physcl)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_menhth)
     $col("center")$text(c.cans.cg.menhth)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_subabs)
     $col("center")$text(c.cans.cg.subabs)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_develp)
     $col("center")$text(c.cans.cg.develp)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_chldcr)
     $col("center")$text(c.cans.cg.chldcr)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_miltra)
     $col("center")$text(c.cans.cg.miltra)
     $col()                                      
    $row()                                      
     $col()$text(q_text_cg_famsts)$text("{sup}5{/sup}")
     $col("center")$text(c.cans.cg.famsts)
	      if $num(c.cans.cg.famsts) > 0
	       $col()FamCareGiveRpt()
	      else
	       $col()
	      endif
    $row()                                      
     $col()$text(q_text_cg_safety)
     $col("center")$text(c.cans.cg.safety)
     $col()
    $row()                                      
     $col()$text(q_text_cg_marvio)
     $col("center")$text(c.cans.cg.marvio)
     $col()
  $endtable($funcname)
 endif  
end CareGiveRpt

'Family/Caregiver Module Report
function FamCareGiveRpt() is null
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"2")$text("Caregiver Strengths & Needs", "datatag")
  $row(,row_color2)
   $col(,,"50%")$text(q_text_fc_selfcr)
   $col("center")$text(c.cans.fc.selfcr)
  $row()                                       
   $col()$text(q_text_fc_culstr) 
   $col("center")$text(c.cans.fc.culstr)
  $row()                                       
   $col()$text(q_text_fc_empedu)
   $col("center")$text(c.cans.fc.empedu)
  $row()                                       
   $col()$text(q_text_fc_eduatt) 
   $col("center")$text(c.cans.fc.eduatt)
  $row()                                       
   $col()$text(q_text_fc_legal )
   $col("center")$text(c.cans.fc.legal )
  $row()                                       
   $col()$text(q_text_fc_motive) 
   $col("center")$text(c.cans.fc.motive)
  $row()                                       
   $col()$text(q_text_fc_finres)
   $col("center")$text(c.cans.fc.finres)
  $row()                                       
   $col()$text(q_text_fc_transp) 
   $col("center")$text(c.cans.fc.transp)
 $endtable($funcname)
end FamCareGiveRpt

'Child Strengths Report
function ChildStrRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("ChildStrengths","datatag")
   $row(,row_color2)
    $col(,,"40%")$text(q_text_cs_family)
    $col("center",,"10%")$text(c.cans.cs.family)
    $col(,,"50%")                               
   $row()                                      
    $col()$text(q_text_cs_extfam)
    $col("center")$text(c.cans.cs.extfam)
    $col()
   $row()                                      
    $col()$text(q_text_cs_intper)
    $col("center")$text(c.cans.cs.intper)
    $col()
   $row()                                      
    $col()$text(q_text_cs_adapt)
    $col("center")$text(c.cans.cs.adapt)
    $col()
   $row()                                      
    $col()$text(q_text_cs_persis)
    $col("center")$text(c.cans.cs.persis)
    $col()
   $row()                                      
    $col()$text(q_text_cs_curios)
    $col("center")$text(c.cans.cs.curios)
    $col()                                                        
  $endtable($funcname)
 endif
end ChildStrRpt

'Culture Report
function CultureRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("Culture","datatag")
   $row(,row_color2)
    $col(,,"40%")$text(q_text_ac_langua)
    $col("center",,"10%")$text(c.cans.ac.langua)
    $col(,,"50%")                               
   $row()                                      
    $col()$text(q_text_ac_identy)
    $col("center")$text(c.cans.ac.identy)
    $col()                                      
   $row()                                      
    $col()$text(q_text_ac_ritual)
    $col("center")$text(c.cans.ac.ritual)
    $col()                                      
   $row()                                      
    $col()$text(q_text_ac_culstr)
    $col("center")$text(c.cans.ac.culstr)
    $col()                               
  $endtable($funcname)
 endif
end CultureRpt

function Validate0() is i                     
 assessment_age is i
 last_type      is x
 last_rloc      is x
 last_aloc      is x
 last_date      is d
 last_alocdate  is d
 datediff       is i
 $clear(errors[])
 if {"lib_UACOMMON"}CurrentDX($regid,c.cans.date) = "N" and (c.cans.type != "3" and c.cans.type != "11")
  (void)$arrpush(errors[],diag_errortxt)
 endif 
 select c.cans.type
  case "3" select c.cans.disreas
             case "9" if c.cans.tcoommi !dp
                       (void)$arrpush(errors[],oth_tc_errortxt)   
                      endif
                      if c.cans.sped !dp
                       (void)$arrpush(errors[],oth_ed_errortxt)   
                      endif  
                      if c.cans.extdrev !dp
                       (void)$arrpush(errors[],oth_ex_errortxt)
                      endif
                      if c.cans.foster !dp
                       (void)$arrpush(errors[],oth_fc_errortxt)
                      endif  
                      if c.cans.riskplc != "N"
                       (void)$arrpush(errors[],oth_rp2_errortxt)
                      endif
			endselect
  case "11"
  case other if c.cans.tcoommi !dp
              (void)$arrpush(errors[],oth_tc_errortxt)   
             endif
             if c.cans.sped !dp
              (void)$arrpush(errors[],oth_ed_errortxt)   
             endif  
             if c.cans.extdrev !dp
              (void)$arrpush(errors[],oth_ex_errortxt)
             endif
             if c.cans.foster !dp
              (void)$arrpush(errors[],oth_fc_errortxt)
             endif  
             if c.cans.riskplc !dp
              (void)$arrpush(errors[],oth_rp_errortxt)
             endif 
 endselect

 {"lib_CANS"}Last_Assessment($regid,,,,last_date,,last_aloc,last_rloc,,,last_alocdate) 
 if c.cans.type = "3"
  datediff = c.cans.disdt - c.cans.date
  if c.cans.disdt !dp
   (void)$arrpush(errors[],disch1_errortxt)
  endif
  if c.cans.disdt < last_alocdate
   (void)$arrpush(errors[],disch4_errortxt)
  endif  
  if c.cans.disreas = "11"
   if datediff > 0
    (void)$arrpush(errors[],disch5_errortxt)
   elseif datediff < -30
    (void)$arrpush(errors[],disch3_errortxt)        
   endif
  else 
   if datediff > 30
    (void)$arrpush(errors[],disch2_errortxt)     
   endif
   if datediff < -30
    (void)$arrpush(errors[],disch3_errortxt)        
   endif
   if last_date > c.cans.disdt
    (void)$arrpush(errors[],disch6_errortxt)           
   endif
  endif 
 endif    

 if c.cans.date < $today
  assessment_age = $today - c.cans.date 
  if assessment_age > 30
   (void)$arrpush(errors[],date1_errortxt)
  endif
 elseif c.cans.date > $today
  (void)$arrpush(errors[],date2_errortxt)
 elseif c.cans.date < last_date
  (void)$arrpush(errors[],date3_errortxt)  
 elseif c.cans.date = last_date 
 (void)$arrpush(errors[],date4_errortxt)  
 endif 

 select c.cans.type
  case "1"  $clear(c.cans.disdt,c.cans.disreas,c.cans.disref,c.cans.disoth)
            if c.cans.intref != "5"
	         $clear(c.cans.intrefoth)
		    endif			   
  case "2"  $clear(c.cans.intref,c.cans.intrefoth,c.cans.disdt,c.cans.disreas,c.cans.disref,c.cans.disoth)
  case "3"  $clear(c.cans.intref,c.cans.intrefoth)
            select c.cans.disreas
			 case "9" 
			 case other ClearPage1()
			            ClearPage2()
						ClearPage3()
						ClearPage4()
			endselect
  case "11" $clear(c.cans.intref,c.cans.intrefoth,c.cans.disdt,c.cans.disreas,c.cans.disref,c.cans.disoth)
            ClearPage1()
            ClearPage2()
            ClearPage3()
            ClearPage4()
  case "12" $clear(c.cans.disdt,c.cans.disreas,c.cans.disref,c.cans.disoth)
 endselect 

 if errors[1] dp	
  Validate0 = 1
 else
  Validate0 = 0	
 endif 
 if c.cans.staff !dp
  c.cans.staff = $operstaffid
 endif 
 c.cans.ver   = $scriptver   
end Validate0

function Validate1() is i
 last_type      is x
 last_rloc      is x
 last_aloc      is x
 last_date      is d
 last_alocdate  is d
 $clear(errors[])
   if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
    if c.cans.ld.family !dp or c.cans.ld.livsit !dp or c.cans.ld.preday !dp or c.cans.ld.socFun !dp or c.cans.ld.recret !dp or c.cans.ld.develp !dp or c.cans.ld.motor !dp or c.cans.ld.commun !dp or c.cans.ld.medicl !dp or c.cans.ld.physcl !dp or
       c.cans.ld.sleep !dp or c.cans.ld.relper !dp
     (void)$arrpush(errors[],ld_errortxt)
    endif  

    if c.cans.cs.family !dp or c.cans.cs.extfam !dp or c.cans.cs.intper !dp or c.cans.cs.adapt !dp or c.cans.cs.persis !dp or c.cans.cs.curios !dp   
     (void)$arrpush(errors[],cs_errortxt)
    endif  

    if c.cans.ac.langua !dp or c.cans.ac.identy !dp or c.cans.ac.ritual !dp or c.cans.ac.culstr !dp or c.cans.ac.culdif !dp
     (void)$arrpush(errors[],ac_errortxt)
    endif  

    if c.cans.cg.super  !dp or c.cans.cg.involv !dp or c.cans.cg.knoldg !dp or c.cans.cg.empath !dp or c.cans.cg.organz !dp or c.cans.cg.socres !dp or c.cans.cg.ressbl !dp or
       c.cans.cg.physcl !dp or c.cans.cg.menhth !dp or c.cans.cg.subabs !dp or c.cans.cg.develp !dp or c.cans.cg.chldcr !dp or c.cans.cg.miltra !dp or c.cans.cg.famsts !dp or 
       c.cans.cg.safety !dp or c.cans.cg.marvio !dp     
     (void)$arrpush(errors[],cg_errortxt)
    endif   
   
    if c.cans.cb.attach !dp or c.cans.cb.regula !dp or c.cans.cb.fthriv !dp or c.cans.cb.depres !dp or c.cans.cb.anxity !dp or c.cans.cb.atypic !dp or c.cans.cb.implsv !dp or c.cans.cb.oppdef !dp or c.cans.cb.adjtrm !dp
     (void)$arrpush(errors[],cb_errortxt)
    endif
    
    if c.cans.cf.birthw !dp or c.cans.cf.pica !dp or c.cans.cf.prenat !dp or c.cans.cf.labdel !dp or c.cans.cf.subexp !dp or c.cans.cf.psprob !dp or c.cans.cf.matava !dp or c.cans.cf.abuse !dp
     (void)$arrpush(errors[],cf_errortxt)
    endif
   
    if c.cans.cr.sfharm !dp or c.cans.cr.aggbeh !dp or c.cans.cr.socbeh !dp
     (void)$arrpush(errors[],cr_errortxt)
    endif   
   endif

   if c.cans.type = "2" and c.cans.cr.sfharm = "3"   
    (void)$arrpush(errors[],crisis1_errortxt)
   endif
   
   if c.cans.type = "11" 
    if c.cans.cr.sfharm != "3" and c.cans.cr.aggbeh != "3" and c.cans.cr.socbeh != "3"
     (void)$arrpush(errors[],crisis2_errortxt)   
    endif
    if c.cans.cr.sfharm !dp or c.cans.cr.aggbeh !dp or c.cans.cr.socbeh !dp
     (void)$arrpush(errors[],cr_errortxt)
    endif   
   endif	

 if errors[1] !dp
  {"lib_CANS"}Last_Assessment($regid,,,,last_date,,last_aloc,last_rloc,,,last_alocdate)  
  if last_type = "1" or last_type = "2"
   c.cans.rloc = RLOC()
   if c.cans.rloc = "110" and last_rloc = "110" and last_aloc != "110"
    (void)$arrpush(errors[],inelig_errortxt)  
   endif
  endif
 endif 			  
  
   if errors[1] dp	
    Validate1 = 1
   else
    Validate1 = 0	
   endif
end Validate1

function Validate2() is i
 $clear(errors[])
'1
 if ($num(c.cans.cb.regula) > 0) and (c.cans.rg.eating !dp or c.cans.rg.elim !dp or c.cans.rg.sensor !dp or c.cans.rg.emot !dp)
  (void)$arrpush(errors[],rg_errortxt)   
 endif      
'2
'Trauma
 if ($num(c.cans.cb.adjtrm) > 0) and (c.cans.tr.sexabs !dp or c.cans.tr.phyabs !dp or c.cans.tr.emoabs !dp or c.cans.tr.medtrm !dp or c.cans.tr.natdis !dp or c.cans.tr.wtofam !dp or c.cans.tr.wtocom !dp or c.cans.tr.wcrime !dp or
                                      c.cans.tr.waraff !dp or c.cans.tr.teraff !dp)   
  (void)$arrpush(errors[],tr_errortxt)                                                                                                                                           
 endif                                                                                                                                                                           
'Adjustment to trauma
 if ($num(c.cans.cb.adjtrm) > 0) and (c.cans.ad.affreg !dp or c.cans.ad.reexp !dp or c.cans.ad.avoid !dp or c.cans.ad.incaro !dp or c.cans.ad.numres !dp or c.cans.ad.timb4t !dp)   
  (void)$arrpush(errors[],adj_errortxt)                                                                                                                                           
 endif                                                                                                                                                                            
'3
 if ($num(c.cans.ld.preday) > 0) and (c.cans.sc.prequa !dp or c.cans.sc.pbehav !dp or c.cans.sc.pachie !dp or c.cans.sc.patten !dp) 
  (void)$arrpush(errors[],sc_errortxt)
 endif  
'4
 if ($num(c.cans.ld.develp) > 0) and (c.cans.dv.cognit !dp or c.cans.dv.selfcr !dp) 
  (void)$arrpush(errors[],dv_errortxt)
 endif     
'5
 if ($num(c.cans.cg.famsts) > 0) and (c.cans.fc.selfcr !dp or c.cans.fc.culstr !dp or c.cans.fc.empedu !dp or c.cans.fc.eduatt !dp or c.cans.fc.legal  !dp or c.cans.fc.motive !dp or c.cans.fc.finres !dp or c.cans.fc.transp !dp)
  (void)$arrpush(errors[],fcg_errortxt)
 endif
 if errors[1] dp	
  Validate2 = 1
 else
  Validate2 = 0	
'Clear the unused dsts
'1 
  if $num(c.cans.cb.regula) = 0
   $clear(c.cans.rg.eating,c.cans.rg.elim,c.cans.rg.sensor,c.cans.rg.emot)
  endif
'2
  if $num(c.cans.cb.adjtrm) = 0
'Trauma
   $clear(c.cans.tr.sexabs,c.cans.tr.phyabs,c.cans.tr.emoabs,c.cans.tr.medtrm,c.cans.tr.natdis,c.cans.tr.wtofam,c.cans.tr.wtocom,c.cans.tr.wcrime,c.cans.tr.waraff,c.cans.tr.teraff)   
'Adjustment to trauma
   $clear(c.cans.ad.affreg,c.cans.ad.reexp,c.cans.ad.avoid,c.cans.ad.incaro,c.cans.ad.numres,c.cans.ad.timb4t)
  endif
'3
 if $num(c.cans.ld.preday) = 0
  $clear(c.cans.sc.prequa,c.cans.sc.pbehav,c.cans.sc.pachie,c.cans.sc.patten) 
 endif 
'4
  if $num(c.cans.ld.develp) = 0
   $clear(c.cans.dv.cognit,c.cans.dv.selfcr)
  endif      
'5  
 endif
end Validate2

function Validate3() is i
 $clear(errors[])
 if $num(c.cans.tr.sexabs) = 0 and (c.cans.tr.emclos !dp or c.cans.tr.freq !dp or c.cans.tr.durat !dp or c.cans.tr.force !dp or c.cans.tr.react !dp)    
  (void)$arrpush(errors[],sxab_errortxt)
 endif  	                            
 if errors[1] dp	
  Validate3 = 1
  else
  Validate3 = 0
  if $num(c.cans.tr.sexabs) = 0
   $clear(c.cans.tr.emclos, c.cans.tr.freq, c.cans.tr.durat, c.cans.tr.force, c.cans.tr.react)
  endif  	 
 endif 
end Validate3

function Validate4() is i
 datediff is i
 $clear(errors[])
 if c.cans.commdate !dp
  (void)$arrpush(errors[],commdt1_errortxt)
 endif
 
 if c.cans.commdate dp and c.cans.commdate < c.cans.date
  (void)$arrpush(errors[],commdt2_errortxt) 
 endif

 if c.cans.school3m !dp or c.cans.grade !dp or c.cans.restype !dp
  (void)$arrpush(errors[],comm_errortxt) 
 endif

 if c.cans.restype != "9"
  $clear(c.cans.resother1)
 endif

 if {"lib_UACOMMON"}IsNumeric(c.cans.arrest) = "N"
  (void)$arrpush(errors[],commarr_errortxt)
 endif 

 datediff = c.cans.commdate - c.cans.date
 if datediff > 30 or datediff < -30
  (void)$arrpush(errors[],commdt4_errortxt)
 endif

 if errors[1] dp	
  Validate4 = 1
 else
  Validate4 = 0	
 endif 
end Validate4

function Page0() is null
 $submitopt("off", "Submit")
 $cancelopt("off", "Back")
 $form($funcname)
  {"lib_UACOMMON"}ClientPageHeader($regid)
  $br()AssessmentDate()
  if StaffAssign_YN = "Y"
   $br()AssessmentStaff()
  endif  
  $br()AssessmentType()
  $tag("<hr/>")
  $br()OtherQuestions()
  select {"lib_UACOMMON"}CurrentDX($regid,c.cans.date)
   case "N" $br()$tag("<hr/>")
            $br()$text(diag_errortxt,"error")
  endselect
 $sendform($funcname)  
end Page0

function Page1() is null
  $submitopt("off", "Submit")
  $cancelopt("off", "Back")
  $form($funcname)
   {"lib_UACOMMON"}ClientPageHeader($regid)
   $br()ReportHdr()
   OtherQuestionRpt()
   $tag("<hr/>")
   $br()
   if c.cans.type = "11"
    $table("1",,table_nobgcolor)
     $row()
      $col(,,"50%")ChildRisk()
      $col()
    $endtable("1")
    $br()
   endif 
   if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
    $table("1",,table_nobgcolor)
     $row()
      $col(,,"50%")ChildRisk()
      $col()
    $endtable("1")
    $br()    
	$tag("<hr/>")
    $br()
    $table("2",,table_nobgcolor)
     $row()
      $col(,,"50%")ChildRiskFactor()
	  $col()
    $endtable("2")
    $br()
    $tag("<hr/>")
    $br()
    $table("3",,table_nobgcolor)
     $row()
      $col(,,"50%")ChildBehave()
      $col()
    $endtable("3")
    $br()
    $tag("<hr/>")
    $br()
    $table("4",,table_nobgcolor)
     $row()
      $col(,,"50%")LifeDomain()
	  $col()
    $endtable("4")
    $br()
    $tag("<hr/>")
    $br()
    $table("5",,table_nobgcolor)
     $row()
      $col(,,"50%")CareGive()
	  $col()
    $endtable("5")
    $br()
    $tag("<hr/>")
    $br()
    $table("6",,table_nobgcolor)
     $row()
      $col(,,"50%")ChildStrength()
      $col()Culture()
    $endtable("6")
    $br()
    $tag("<hr/>")
    $br()
   endif
  $sendform($funcname)
end Page1

function Page2() is null
 $submitopt("off", "Submit")
 $cancelopt("off", "Back")
 $form($funcname)    
  {"lib_UACOMMON"}ClientPageHeader($regid)
  $br()ReportHdr()
  OtherQuestionRpt()
  $tag("<hr/>")
  $table($funcname,,table_nobgcolor)
   if $num(c.cans.cb.regula) > 0
    $row()
	 $col(,,"50%")$fieldset("Regulatory Functions",,"datatag")
	               CBScoring()
		          $endfieldset()
	 $col()
	$row()
	 $col(,,"50%")regulatory()
	 $col()
	$row()
	 $col()$br()
	       $tag("<hr/>")
           $br()
    endif	   
   if $num(c.cans.cb.adjtrm) > 0 
    $row()
	 $col(,,"50%")$fieldset("Child Behavioral and Emotional Needs",,"datatag")
	               CBScoring()
				  $endfieldset() 
	 $col()
	$row()
     $col(,,"50%")trauma() 
                  adjust()
     $col()
    $row()
	 $col()$br()
           $tag("<hr/>")
           $br()	 
   endif
   if $num(c.cans.ld.preday) > 0 or $num(c.cans.ld.develp) > 0
     $row()
	  $col(,,"50%")$fieldset("Life Domain",,"datatag")
	                LDScoring()
				   $endfieldset()
	  $col()
   endif
   if $num(c.cans.ld.preday) > 0	
    $row()
     $col(,,"50%")school()
     $col()
   endif
   if $num(c.cans.ld.develp) > 0
    $row()
     $col(,,"50%")DevNeeds()
     $col()
   endif
   if $num(c.cans.ld.preday) > 0 or $num(c.cans.ld.develp) > 0
    $row()
	 $col()$br()
           $tag("<hr/>")
           $br()
   endif
   if $num(c.cans.cg.famsts) > 0
    $row()
	 $col()$fieldset("Family/Caregiver",,"datatag")
	        CareGiverScoring()
		   $endfieldset()
	 $col()
    $row()
     $col(,,"50%")FamilyCareGive()
     $col()
   endif
  $endtable($funcname)	
 $sendform($funcname)
end Page2

function Page3() is null
 $submitopt("off","Submit")
 $cancelopt("off","Back")
 $form($funcname)
  {"lib_UACOMMON"}ClientPageHeader($regid)
  $br()ReportHdr()
  OtherQuestionRpt()
  $tag("<hr/>")  
   $table($funcname,,table_nobgcolor)
    $row()
	 $col(,,"50%")sexab1()
	 $col()
   $endtable($funcname)
 $sendform($funcname)
end Page3

function Page4() is null
 $submitopt("off","Submit")
 $cancelopt("off","Back")
 $form($funcname)    
  {"lib_UACOMMON"}ClientPageHeader($regid)
  $br()ReportHdr()
  if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
   OtherQuestionRpt()
   $tag("<hr/>")  
   $table($funcname,,table_nobgcolor)
    $row()
     $col("right",,"50%")$text(q_text_commdate,"datatag")
     $col()$textbox(c.cans.commdate,"CAL",10,6,"Y","normal")
    $row()
     $col("right",,"50%")$text(q_text_school3m,"datatag")
     $col()$radio(c.cans.school3m,"No","0")$ctag("&nbsp;&nbsp;")$radio(c.cans.school3m,"Yes","1")$ctag("&nbsp;&nbsp;")$radio(c.cans.school3m,"NA","2")
    $row()
     $col("right")$text(q_text_grade,"datatag")
     $col()$dropboxdct(c.cans.grade,CansGradeDCT,,,,"Y")
    $row()
     $col("right")$text(q_text_arrest,"datatag")
     $col()$textbox(c.cans.arrest,,2,2,"Y")
    $row()
     $col("right")$text(q_text_restype,"datatag")
     $col()$dropboxdct(c.cans.restype,CansResTypeDCT,,,,"Y")
	       $dropbox(c.cans.restype,"Other","9",,,"OTHER","OTHER","Y")       
   $endtable($funcname)
   $block("OTHER","OTHER")
    $table("OTHER",,table_nobgcolor)
     $row()
      $col("right")$text(q_text_resother1,"datatag")
      $col()$textbox(c.cans.resother1,,100,110,"Y")
    $endtable("OTHER")
   $endblock("OTHER","OTHER")

  $br(2)$text(q_text_bips11, "datatag")$text(q_text_bips12, "datatag")
  $br()$radio(c.cans.bipsq1,a_text_bips11,"Y",,,,,,"Y")
  $br()$radio(c.cans.bipsq1,a_text_bips12,"N",,,,,,"Y")
  $br()$radio(c.cans.bipsq1,a_text_bips13,"U",,,,,,"Y")

  $br(2)$text(q_text_bips2, "datatag")
  $br()$radio(c.cans.bipsq2,a_text_bips21,"LAR",,,,,,"Y")
  $br()$radio(c.cans.bipsq2,a_text_bips22,"SELF",,,,,,"Y")
  $br()$radio(c.cans.bipsq2,a_text_bips23,"NLAR",,,,,,"Y")
  endif
 $sendform($funcname)
end Page4

function Page4Rpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  c_cans_grade = $dct(CansGradeDCT,c.cans.grade)
  c_cans_restype = $dct(CansResTypeDCT,c.cans.restype)
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"2")$text("Community Scales","datatag")
   $row()
    $col("right",,"50%")$text(q_text_commdate)
    $col()$text(c.cans.commdate)
   $row()
    $col("right")$text(q_text_school3m)
    $col()select c.cans.school3m
           case "0" $text("No")
	       case "1" $text("Yes")
	       case "2" $text("NA")
	      endselect 
   $row()
    $col("right")$text(q_text_grade)
    $col()$text(c_cans_grade)
   $row()
    $col("right")$text(q_text_arrest)
    $col()$text(c.cans.arrest)
   $row()
    $col("right")$text(q_text_restype)
    $col()$text(c_cans_restype)       
  if c.cans.resother1 dp
   $row()
    $col("right")$text(q_text_resother1)
    $col()$text(c.cans.resother1)
  endif 
   $row()
    $col("right")$text(q_text_bips11)
     $br()$text(q_text_bips12)
    $col()
     select c.cans.bipsq1
      case "Y" $text(a_text_bips11)
      case "N" $text(a_text_bips12)
      case "U" $text(a_text_bips13)
     endselect
   $row()
    $col("right")$text(q_text_bips2)
    $col()
     select c.cans.bipsq2
      case "LAR"  $text(a_text_bips21)
      case "SELF" $text(a_text_bips22)
      case "NLAR" $text(a_text_bips23)
     endselect
  $endtable($funcname)   
 endif
end Page4Rpt

function CanSkipPage1() is x
 CanSkipPage1 = "N"
 select c.cans.type
  case "3" select c.cans.disreas
             case "9"
			 case other CanSkipPage1 = "Y"
			endselect
 endselect 
end CanSkipPage1

function CanSkipPage2() is x
 CanSkipPage2 = "Y"
 if $num(c.cans.cb.regula) > 0 or
	$num(c.cans.cb.adjtrm) > 0 or 
	$num(c.cans.ld.preday) > 0 or 
	$num(c.cans.ld.develp) > 0 or 
	$num(c.cans.cg.famsts) > 0
  CanSkipPage2 = "N"
 endif	
end CanSkipPage2

function CanSkipPage3() is x
 CanSkipPage3 = "Y"
 if $num(c.cans.tr.sexabs) > 0
  CanSkipPage3 = "N"
 endif
end CanSkipPage3

function CanSkipPage4() is x
 CanSkipPage4 = "N"
 select c.cans.type
  case "3" select c.cans.disreas
             case "9"
			 case other CanSkipPage4 = "Y"
			endselect
  case "11"  CanSkipPage4 = "Y"
 endselect   
' if `$today - c.cans.date` > 30 
'  CanSkipPage4 = "N" 
' endif 
end CanSkipPage4

function ChildRiskScoring() is null
 $table($funcname,,`table_wbgcolor`)  
  $row()
   $col(,,"50%")$text("0 = no evidence","hdrdata")
   $col()$text("1 = history; watch/prevent","hdrdata")
  $row()
   $col()$text("2 = recent; action item","hdrdata")
   $col()$text("3 = acute; immediate action","hdrdata")
  $row()
   $col("center",,,"2") $tag("<hr/>")
 $endtable($funcname)
end ChildRiskScoring

function CBScoring() is null
 ChildRiskScoring()
end CBScoring

function LDScoring() is null
 $table($funcname,,`table_wbgcolor`)
  $row()
   $col(,,"50%")$text("0 = no evidence of needs","hdrdata")
   $col()$text("1 = history, mild needs","hdrdata")
  $row()
  $col()$text("2 = moderate needs","hdrdata")
   $col()$text("3 = severe needs","hdrdata")
  $row()
   $col("center",,,"2") $tag("<hr/>")
 $endtable($funcname)
end LDScoring

function CareGiverScoring() is null
 $table($funcname,,`table_wbgcolor`)  
  $row()
   $col(,,"50%")$text("0 = no evidence","hdrdata")
   $col()$text("1 = minimal needs","hdrdata")
  $row()
   $col()$text("2 = moderate needs","hdrdata")
   $col()$text("3 = severe needs","hdrdata")
  $row()
    $col("center",,,"2") $tag("<hr/>")
 $endtable($funcname)
end CareGiverScoring

function RegulaRpt() is null
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"3")$text("Regulatory Functioning","datatag")
  $row(,row_color2)
   $col(,,"40%")$text(q_text_rg_eating)
   $col("center",,"10%")$text(c.cans.rg.eating)
   $col(,,"50%")                               
  $row()                                      
   $col()$text(q_text_rg_elim)
   $col("center")$text(c.cans.rg.elim)
   $col()
  $row()                                      
   $col()$text(q_text_rg_sensor)
   $col("center")$text(c.cans.rg.sensor)
   $col()     
  $row()                                      
   $col()$text(q_text_rg_emot)
   $col("center")$text(c.cans.rg.emot)
   $col()
 $endtable($funcname)
end RegulaRpt

function Regulatory() is null
 bgcolor = "white"
 if $find(rg_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Regulatory Functioning",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo  
   $row(,row_color3)
    $col()$text(q_text_rg_eating)
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.rg.eating,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_rg_elim)
	radio_index = -1
	do while radio_index++ < 3
   	 $col("center")$radio(c.cans.rg.elim,,$castx(radio_index))
	enddo	
   $row(,row_color3)
    $col()$text(q_text_rg_sensor)
	radio_index = -1
	do while radio_index++ < 3
 	 $col("center")$radio(c.cans.rg.sensor,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_rg_emot)
	radio_index = -1
	do while radio_index++ < 3
  	 $col("center")$radio(c.cans.rg.emot,,$castx(radio_index))
	enddo		
  $endtable($funcname)
 $endfieldset()
end Regulatory

function ChildRiskFactor() is null
 bgcolor = "white"
 if $find(cf_errortxt,errors[],,"F") > 0
  bgcolor = "red"
 endif
 $fieldset("Child Risk Factor",,"datatag")
  $table($funcname,,`table_wbgcolor`)
   $row()
    $col("center",,"50%")
	radio_index = -1
	do while radio_index++ < 3
     $col("center",,"10%")$text(radio_index)
	enddo
   $row()
    radio_index = 0
	do while radio_index++ < 5
     $col()$tag("<hr/>")
	enddo  
   $row(,row_color1)
    $col()$text(q_text_cf_birthw)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.birthw,,$castx(radio_index))
	enddo	
   $row(,row_color2)
    $col()$text(q_text_cf_pica)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.pica,,$castx(radio_index))
	enddo	
   $row(,row_color1)
    $col()$text(q_text_cf_prenat)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.prenat,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_cf_labdel)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.labdel,,$castx(radio_index))
	enddo
   $row(,row_color1)
    $col()$text(q_text_cf_subexp)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.subexp,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_cf_psprob)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.psprob,,$castx(radio_index))
	enddo
   $row(,row_color1)
    $col()$text(q_text_cf_matava)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.matava,,$castx(radio_index))
	enddo
   $row(,row_color2)
    $col()$text(q_text_cf_abuse)
	radio_index = -1
	do while radio_index++ < 3
     $col("center")$radio(c.cans.cf.abuse,,$castx(radio_index)) 
	enddo
  $endtable($funcname)
 $endfieldset()
end ChildRiskFactor

function ChildRiskFacRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row(,col_color_multi)
    $col("center",,,"3")$text("Child Risk Factors","datatag")
   $row(,row_color2)
    $col(,,"40%")$text(q_text_cf_birthw)
    $col("center",,"10%")$text(c.cans.cf.birthw)
    $col(,,"50%")
   $row()
    $col()$text(q_text_cf_pica)
    $col("center")$text(c.cans.cf.pica)
    $col()
   $row()
    $col()$text(q_text_cf_prenat)
    $col("center")$text(c.cans.cf.prenat)
    $col()
   $row()
    $col()$text(q_text_cf_labdel)
    $col("center")$text(c.cans.cf.labdel)
    $col()
   $row()
    $col()$text(q_text_cf_subexp)
    $col("center")$text(c.cans.cf.subexp)
    $col()
   $row()
    $col()$text(q_text_cf_psprob)
    $col("center")$text(c.cans.cf.psprob)
    $col()         
   $row()
    $col()$text(q_text_cf_matava)
    $col("center")$text(c.cans.cf.matava)
    $col()
   $row()
    $col()$text(q_text_cf_abuse)
    $col("center")$text(c.cans.cf.abuse)
    $col()         
  $endtable($funcname)
 endif
end ChildRiskFacRpt

'Initial Validations before starting the assessment
function Validate() is i
 $clear(errors[])
 c.cans.age = {"lib_UACOMMON"}ClientAge($regid)
 if c.cans.age > 17
  (void)$arrpush(errors[],age_errortxt)
 elseif c.cans.age < 3
  (void)$arrpush(errors[],age1_errortxt)
 elseif c.cans.age = 0 
  (void)$arrpush(errors[],age2_errortxt)
 endif 

  if errors[1] dp	
   Validate = 1
  else
   Validate = 0	
  endif
 end Validate
 
function ReportHdr() is null
 c_cans_type    is x
 c_cans_intref  is x
 c_cans_disreas is x
 c_cans_disref  is x
 c_cans_type    = $dct(CansTypeDCT,c.cans.type)
 c_cans_intref  = $dct(CansIntRefDCT,c.cans.intref)
 c_cans_disreas = $dct(CansDisReasDCT,c.cans.disreas)
 c_cans_disref  = $dct(CansDisRefDCT,c.cans.disref) 
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
  $row()
   $col(,,"5%")
   $col(,,"15%")$text(q_text_date)
   $col(,,"80%")$text(c.cans.date)
  $row()
   $col()
   $col()$text(q_text_type)
   $col()$text(c_cans_type) 
  if c.cans.type = "1" or c.cans.type = "12"
   $row()
    $col()
    $col()$text(q_text_intref)
    $col()$text(c_cans_intref)
   if c.cans.intrefoth dp
    $row()
     $col()
     $col()$text(q_text_intrefoth)
     $col()$text(c.cans.intrefoth)
   endif
  endif
  if c.cans.type = "3"
   $row()
    $col()
    $col()if c.cans.alocdate dp
	       $text(q_text_disdt)
		  else
	       $text(q_text_rdisdt)		  
		  endif 
    $col()$text(c.cans.disdt)
   $row()
    $col()
    $col()$text(q_text_disreas)
    $col()$text(c_cans_disreas)
   if c.cans.disoth dp
    $row()
     $col()
     $col()$text(q_text_disoth)
     $col()$text(c.cans.disoth)
   endif
   $row()
    $col()
    $col()$text(q_text_disref)
    $col()$text(c_cans_disref)
  endif  
   $row()
    $col()
    $col()$text("Medicaid Status:")
    $col()$text(medicaid_status)
 $endtable($funcname)
 $br()$tag("<hr/>")
 $br()
end ReportHdr

function AssessmentDate() is null
 $table($funcname,,table_nobgcolor)
  $row()
   $col("right",,"50%")$text(q_text_date, "datatag")
   $col()$textbox(c.cans.date,"CAL",10,6,"Y","normal")
 $endtable($funcname)
end AssessmentDate

function AssessmentType() is null
 index is i
 index = 0
 $table($funcname,,table_nobgcolor)
  $row()
   $col("right",,"50%")$text(q_text_type,"datatag")
   $col()do while index++ < $maxarray(assessments[])
          $radio(c.cans.type,$dct(CansTypeDCT,assessments[index]),assessments[index],,,assessments[index],assessments[index])$ctag("&nbsp;&nbsp;&nbsp;")
		 enddo
  $endtable($funcname)		 
  $block("1","1")
   $table("1",,table_nobgcolor)
    $row()
     $col("right",,"50%")$text(q_text_intref,"datatag")
     $col()$dropboxdct(c.cans.intref,CansIntRefDCT,,,,"Y")
	       $dropbox(c.cans.intref,"Other","5",,,"1","OTHER","Y")
   $endtable("1")
  $endblock("1","1")
  $block("1","OTHER")
   $table("OTHER",,table_nobgcolor)
    $row()
     $col("right",,"50%")$text(q_text_intrefoth,"datatag")
     $col()$textbox(c.cans.intrefoth,,50,60,"Y")
   $endtable("OTHER")
  $endblock("1","OTHER")
  $block("3","3")
   $table("3",,table_nobgcolor)
    $row()
     $col("right",,"50%")$text(q_text_rdisdt,"datatag")
     $col()$textbox(c.cans.disdt,"CAL",10,6,,"normal")
    $row()
     $col("right",,"50%")$text(q_text_disreas,"datatag")
     $col()$dropboxdct(c.cans.disreas,CansDisReasDCT,,,,"Y")
           $dropbox(c.cans.disreas,"Other","7",,,"3","OTHER","Y")	 
    $row()
     $col("right",,"50%")$text(q_text_disref,"datatag")
     $col()$dropboxdct(c.cans.disref,CansDisRefDCT,,,,"Y")
   $endtable("3")
  $endblock("3","3")
  $block("3","OTHER")
   $table("OTHER",,table_nobgcolor)
    $row()
     $col("right",,"50%")$text(q_text_disoth,"datatag")
     $col()$textbox(c.cans.disoth,,50,60,"Y")
   $endtable("OTHER")
  $endblock("3","OTHER")  
end AssessmentType

function OtherQuestions() is null
 $table($funcname,,table_nobgcolor)
  $row()
   $col("right",,"50%")$text(q_text_tcoommi,"datatag")
   $col()$radio(c.cans.tcoommi,"No","N")$radio(c.cans.tcoommi,"Yes","Y")
  $row()
   $col("right",,"50%")$text(q_text_sped,"datatag")
   $col()$radio(c.cans.sped,"No","N")$radio(c.cans.sped,"Yes","Y")
  $row()
   $col("right",,"50%")$text(q_text_extdrev,"datatag")
   $col()$radio(c.cans.extdrev,"No","N")$radio(c.cans.extdrev,"Yes","Y")
  $row()
   $col("right",,"50%")$text(q_text_foster,"datatag")
   $col()$radio(c.cans.foster,"No","N")$radio(c.cans.foster,"Yes","Y")
  $row()
   $col("right",,"50%")$text(q_text_riskplc,"datatag")
   $col()$radio(c.cans.riskplc,"No","N")$radio(c.cans.riskplc,"Yes","Y")
 $endtable($funcname)
end OtherQuestions

function OtherQuestionRpt() is null
 if c.cans.type = "1" or c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas = "9") or c.cans.type = "12"
  $br()
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White' style='border-style: solid; border-width: 1px'")
   $row()
    $col("right",,"50%")$text(q_text_tcoommi)
	$col()$text(c.cans.tcoommi)
   $row()
    $col("right",,"50%")$text(q_text_sped)
    $col()$text(c.cans.sped)
   $row()
    $col("right",,"50%")$text(q_text_extdrev)
    $col()$text(c.cans.extdrev)
   $row()
    $col("right",,"50%")$text(q_text_foster)
    $col()$text(c.cans.foster)
   $row()
    $col("right",,"50%")$text(q_text_riskplc)
    $col()$text(c.cans.riskplc)
  $endtable($funcname)
 endif
end OtherQuestionRpt

function ALOC() is null
 last_type     is x
 last_aloc     is x
 last_alocdate is d
 CurrentDX     is x
 
 c_cans_rloc = $dct(CansAuthLevelDCT,c.cans.rloc)
 c_cans_dloc = $dct(CansAuthLevelDCT,c.cans.dloc)
 c_cans_aloc = $dct(CansAuthLevelDCT,c.cans.aloc) 
 
 CurrentDX = {"lib_UACOMMON"}CurrentDX($regid,c.cans.date)
 if c.cans.rloc = "100" or c.cans.type = "11" or (c.cans.type = "3" and c.cans.disreas != "9")
  CurrentDX = "Y"
 endif
 {"lib_CANS"}Last_Assessment($regid,last_type,,,,,last_aloc) 
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "12"
    $col("center",,,"2")$text("Authorized Level Of Care","datatag")
   elseif c.cans.type = "3"
    $col("center",,,"2")$text("Discharge","datatag")	
   elseif c.cans.type = "11"
    $col("center",,,"2")$text("Authorized Level Of Care: Crisis","datatag")
   endif
   if c.cans.type = "3"
    $row()
     $col("right",,"50%")$text(q_text_rdisdt,"datatag")
     $col()$textbox(c.cans.disdt,"CAL",10,6,,"normal")  
   endif  
   if CurrentDX = "Y"
    $row()
     $col("right",,"50%")$text(q_text_alocdate,"datatag")
     $col()$textbox(c.cans.alocdate,"CAL",10,6,"Y","normal")
     if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "12"
      $row()
       $col("right",,"50%")$text(q_text_rloc,"datatag")
       $col()$text(c_cans_rloc)
      if c.cans.dloc dp
       $row()
        $col("right",,"50%")$text(q_text_dloc,"error")
	    $col()$text(c_cans_dloc) 
      endif	
      $row()
       $col("right",,"50%")$text(q_text_aloc,"datatag")
	   $col()$dropboxdct(c.cans.aloc,CansAuthLevelDCT,,,,"Y")
      if (c.cans.aloc dp and c.cans.rloc dp) and (c.cans.rloc != c.cans.aloc)
	   $row()
        $col("right",,"50%")$text(q_text_loc_dev,"datatag")
	    $col()$dropboxdct(c.cans.loc_dev,CansDeviationDCT)
              $dropbox(c.cans.loc_dev,"Other","5",,,"OTHER","OTHER")	
       $row()
        $col("right",,"50%")$text(q_text_devjust,"datatag")
        $col()$textblock(c.cans.devjust,5,,,"Y",255,"width:100%;")$countbox(c.cans.devjust,"(max chars is 255)")			 
      endif
     endif
     if c.cans.type = "11" or c.cans.rloc = "100"
      c.cans.aloc = "100"
	  c_cans_aloc = $dct(CansAuthLevelDCT,c.cans.aloc) 
      $row()
       $col("right",,"50%")$text(q_text_rloc,"datatag")
       $col()$text(c_cans_rloc)  
      $row()
       $col("right",,"50%")$text(q_text_aloc,"datatag")
       $col()$text(c_cans_aloc)  
     endif	 	
 $endtable($funcname)
  $block("OTHER","OTHER")
   $table("OTHER",,table_nobgcolor)
    $row()
     $col("right",,"50%")$text(q_text_devoth,"datatag")
     $col()$textblock(c.cans.devoth,5,,,"Y",50,"width:100%;")$countbox(c.cans.devoth,"(max chars is 50)")
   $endtable("OTHER")
  $endblock("OTHER","OTHER")

  if medicaid_status = "Medicaid Recipient"
   if (($num(c.cans.aloc) <  $num(last_aloc) and last_aloc dp) and (c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas != "9"))) or
      (c.cans.type = "1" and $num(c.cans.aloc) < $num(c.cans.rloc))
    $table($funcname,,table_nobgcolor)
     $row()
      $col("right",,"50%")$text(q_text_fairhear,"datatag")
      $col()$radio(c.cans.fairhear,"Yes","Y",,,,,,"Y")$ctag("&nbsp;&nbsp;&nbsp;&nbsp;")$radio(c.cans.fairhear,"No","N",,,,,,"Y")
   $endtable($funcname)
   endif 		  
  endif 


  $table($funcname,,table_nobgcolor)
   $row()
    $col("right",,"50%")$text(q_text_acomment,"datatag")
    $col()$textblock(c.cans.acomment,5,,,,255,"width:100%;")$countbox(c.cans.acomment,"(max chars is 255)")  
    if c.cans.type != "3"
   $row()
    $col("right")$text("Include LPHA Medical Necessity Statement?")
    $col()$checkbox(chk_MedNec, "Yes", "Y")
     else
      chk_MedNec = "N"
    endif
  $endtable($funcname) 

   else
     $row()
      $col("center",,"100%","2")$text(diag_errortxt,"error")
    $endtable($funcname) 
   endif
end ALOC

function ALOCRpt() is null
 sigline = $dct(2071, $oper, "D")
 sigline += " (" + $operstaffid + ")" 
 
 c_cans_rloc     = $dct(CansAuthLevelDCT,c.cans.rloc)
 c_cans_dloc     = $dct(CansAuthLevelDCT,c.cans.dloc)
 c_cans_aloc     = $dct(CansAuthLevelDCT,c.cans.aloc)
 c_cans_loc_dev  = $dct(CansDeviationDCT,c.cans.loc_dev)
 c_cans_fairhear = $dct(29,c.cans.fairhear) 

 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "12"
    $col("center",,,"2")$text("Authorized Level Of Care","datatag")
   elseif c.cans.type = "3"
    $col("center",,,"2")$text("Discharge","datatag")
   elseif c.cans.type = "11"
    $col("center",,,"2")$text("Authorized Level Of Care: Crisis","datatag")
   endif
  $row()
   $col("right",,"50%")$text(q_text_alocstaff,"datatag")
   $col()$text(sigline)
  $row()
   $col("right",,"50%")$text(q_text_alocdate,"datatag")
   $col()$text(c.cans.alocdate)
  if c.cans.type != "3"
   $row()
    $col("right",,"50%")$text(q_text_alocedate,"datatag")
    $col()$text(c.cans.alocedate)
    $row()
  endif
  if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "11" or c.cans.type = "12"
   $row()
    $col("right",,"50%")$text(q_text_rloc,"datatag")
    $col()$text(c_cans_rloc)
  endif
  if c.cans.dloc dp
   $row()
    $col("right",,"50%")$text(q_text_dloc,"datatag")
    $col()$text(c_cans_dloc)              
  endif	
  if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "11" or c.cans.type = "12"
   $row()
    $col("right",,"50%")$text(q_text_aloc,"datatag")
    $col()$text(c_cans_aloc) 
  endif
  if c.cans.loc_dev dp
   $row()
    $col("right",,"50%")$text(q_text_loc_dev,"datatag")
    $col()$text(c_cans_loc_dev)
  endif  
  if c.cans.devoth dp
   $row()
    $col("right",,"50%")$text(q_text_devoth,"datatag")
    $col()$text(c.cans.devoth)
  endif
  if c.cans.devjust dp
   $row()
    $col("right",,"50%")$text(q_text_devjust,"datatag")
    $col()$text(c.cans.devjust)
  endif  
  if c.cans.fairhear dp
   $row()
    $col("right",,"50%")$text(q_text_fairhear,"datatag")
    $col()$text(c_cans_fairhear)
  endif 
  if c.cans.acomment dp
   $row()
    $col("right",,"50%")$text(q_text_acomment,"datatag")
    $col()$text(c.cans.acomment) 
  endif
 $endtable($funcname)
 if chk_MedNec = "Y"
  $br(2)$text(MedicalNecessity,"siginfo")
 endif 
 $br()
 if ChangeIRMSHeader = "Y"
  {"lib_UACOMMON"}ChangeTitle($scriptid)
 endif 
 {"l_snapLibSC"}sn_CreateReport(RptTitle,,,ReportID)
end ALOCRpt

'CANS 3-5 RLOC
function RLOC() is x
 DXType is x
 PP     is x
 {"lib_ANSA"}GETDX($regid,DXType,,,,,PP)  
 select c.cans.type
  case "1" if c.cans.cr.sfharm = "3" or c.cans.cr.aggbeh = "3" or c.cans.cr.socbeh = "3"
            RLOC = "100"
			c.cans.type = "11"
		   else
		    if (DXType = "B" or DXType = "S" or DXType = "D" or PP = "Y")
		     RLOC = "105"
			else
             RLOC = "110"		   
			endif
		   endif	
  case "3" 'select c.cans.disreas
           ' case "9" RLOC = "105"
		   '	case other $clear(RLOC)
		   '  endselect
		   $clear(RLOC)
  case "11" RLOC = "100"
  case "12" RLOC = "110"		   
  case other RLOC = "105"
 endselect
end RLOC

function ValidateALOC() is i
 $clear(errors[])
 CurrentDX     is x
 last_type     is x
 last_aloc     is x
 last_date     is d
 last_alocdate is d
 datediff      is i
 
 $clear(last_type, last_aloc, last_alocdate)
 {"lib_CANS"}Last_Assessment($regid,last_type,,,,,last_aloc,,,,last_alocdate) 
 if c.cans.aloc dp 

  if c.cans.aloc != c.cans.rloc
   if c.cans.loc_dev !dp
    (void)$arrpush(errors[],aloc3_errortxt)
   else
	if c.cans.aloc = "109" and c.cans.loc_dev != "1"
     (void)$arrpush(errors[],locdev4_errortxt)		
	elseif c.cans.aloc = "108" and c.cans.loc_dev != "2"
     (void)$arrpush(errors[],locdev3_errortxt)		
	endif
	if (c.cans.aloc != "109" and c.cans.aloc != "108" and c.cans.aloc != "107") and $num(c.cans.aloc) > $num(c.cans.rloc) and (c.cans.loc_dev != "3" and c.cans.loc_dev != "4" and c.cans.loc_dev != "5")
     (void)$arrpush(errors[],locdev1_errortxt)	
	endif
    if (c.cans.aloc != "109" and c.cans.aloc != "108" and c.cans.aloc != "107") and $num(c.cans.aloc) < $num(c.cans.rloc) and 
       (c.cans.loc_dev != "1" and  c.cans.loc_dev != "2" and  c.cans.loc_dev != "3" and  c.cans.loc_dev != "4" and  c.cans.loc_dev != "5")
     (void)$arrpush(errors[],locdev2_errortxt)	
	endif	
   endif
  endif 

  if medicaid_status = "Medicaid Recipient" and c.cans.fairhear !dp
   if ($num(c.cans.aloc) <  $num(last_aloc) and last_aloc dp) and (c.cans.type = "2" or (c.cans.type = "3" and c.cans.disreas != "9"))
    (void)$arrpush(errors[],fairhear_errtxt)  
   endif  
   if c.cans.type = "1" and $num(c.cans.aloc) < $num(c.cans.rloc)
    (void)$arrpush(errors[],fairhear_errtxt)     
   endif
  endif   

  if c.cans.aloc = "108" and (c.cans.type != "1" and c.cans.type != "12")
  (void)$arrpush(errors[],aloc13_errortxt)
  endif
  if c.cans.aloc = "109" and c.cans.type != "1"
  (void)$arrpush(errors[],aloc15_errortxt)
  endif

  if c.cans.aloc = "110" and (c.cans.type != "1" and c.cans.type != "12")
   (void)$arrpush(errors[],aloc14_errortxt)
  endif   
 
  if c.cans.rloc = "100" and c.cans.aloc != c.cans.rloc
   (void)$arrpush(errors[],aloc1_errortxt)  
  endif
'  if c.cans.aloc != "100" and c.cans.aloc != "105"
'   (void)$arrpush(errors[],aloc2_errortxt)
'  endif
  if c.cans.aloc != c.cans.rloc and c.cans.loc_dev !dp
   (void)$arrpush(errors[],aloc3_errortxt)
  endif  
    if c.cans.aloc = "100" and (last_type = "I" or last_type = "U" or last_type = "1" or last_type = "2")
    (void)$arrpush(errors[],aloc9_errortxt)  
  endif
  if c.cans.aloc = c.cans.rloc and c.cans.loc_dev dp
   $clear(c.cans.loc_dev,c.cans.devoth,c.cans.devR1,c.cans.devR2,c.cans.devR3,c.cans.devR4,c.cans.devR5, c.cans.devjust)   
  endif
 else
  if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "12"
   (void)$arrpush(errors[],aloc4_errortxt)  
  endif
 endif
 if c.cans.alocdate dp
  if c.cans.alocdate > $today
   (void)$arrpush(errors[],aloc7_errortxt)    
  endif
  if c.cans.alocdate <= last_alocdate
   (void)$arrpush(errors[],aloc8_errortxt)    
  endif
  if c.cans.alocdate < c.cans.commdate
   (void)$arrpush(errors[],commdt3_errortxt)      
  endif
  if c.cans.alocdate < c.cans.date  
   (void)$arrpush(errors[],aloc16_errortxt)    
  endif    
 else
  (void)$arrpush(errors[],aloc5_errortxt)  
 endif
 
 if c.cans.type = "3"
  datediff = c.cans.disdt - c.cans.date
  if c.cans.disdt !dp
   (void)$arrpush(errors[],disch1_errortxt)
  endif
  if c.cans.disdt < last_alocdate
   (void)$arrpush(errors[],disch4_errortxt)
  endif  
  if c.cans.disreas = "11"
   if datediff > 0
    (void)$arrpush(errors[],disch5_errortxt)
   elseif datediff < -30
    (void)$arrpush(errors[],disch3_errortxt)        
   endif
  else 
   if datediff > 30
    (void)$arrpush(errors[],disch2_errortxt)     
   endif
   if datediff < -30
    (void)$arrpush(errors[],disch3_errortxt)        
   endif
   if last_date > c.cans.disdt
    (void)$arrpush(errors[],disch6_errortxt)           
   endif
  endif 
 endif    
 
 CurrentDX = {"lib_UACOMMON"}CurrentDX($regid,c.cans.date)
 if CurrentDX = "N"
  if c.cans.rloc = "100" or c.cans.type != "11" or (c.cans.type = "3" and c.cans.disreas != "9")
   CurrentDX = "Y"
  endif
 endif

 
 if errors[1] dp	
  ValidateALOC = 1
 else
  ValidateALOC = 0	
 endif 

 c.cans.alocedate = {"lib_CANS"}EndDate(c.cans.aloc,c.cans.alocdate,c.cans.extdrev) 
 c.cans.alocstaff = $operstaffid
 c.cans.compd = $today
 if c.cans.type = "3" and  c.cans.disreas != "9"
  $clear(c.cans.rloc,c.cans.aloc)
 endif
 select c.cans.aloc
  case "100" c.cans.type = "11"
  case "110" if c.cans.type = "1"
              c.cans.type = "12"
			 endif 
  case "108" if c.cans.type = "1"
              c.cans.type = "12"
             endif
			 c.cans.loc_dev = "2"
			 $clear(c.cans.devjust)
  case "109" c.cans.loc_dev = "1"
   			 $clear(c.cans.devjust)
 endselect
 if c.cans.type = "12" and (c.cans.aloc != "108" and c.cans.aloc != "120")
  c.cans.type = "1"
 endif
 if c.cans.dloc = "108" or c.cans.dloc = "109" or c.cans.dloc = "110"
  $clear(c.cans.dloc)
 endif 
end ValidateALOC

function ValidateReport() is i
 $clear(errors[])
 if c.cans.dloc = c.cans.rloc and c.cans.dloc dp
  (void)$arrpush(errors[],dloc_errortxt)
  $clear(c.cans.dloc)
 endif 
 if errors[1] dp	
  ValidateReport = 1
 else
  ValidateReport = 0	
 endif 
 if c.cans.dloc !dp
  $clear(c.cans.dloc)
 endif
end ValidateReport

function SaveEvent() is x
 e.case.no = $regid
 e.staff   = $operstaffid									    
 e.date    = c.cans.date
 e.cl.dur  = e.dur
 rc = $insertevent(e.date, e.staff, e.case.no, e.ru, e.ser, e.start, e.cl.dur, e.dur, e.loc)
 rc = $isncreate("T",,,$erkey,e.case.no, e.staff, e.date, e.start, e.ser, "Y")
 SaveEvent = $isnkey
end SaveEvent

function GetEvent($$isn.sac,$$isn.ru,$$isn.tm,$$isn.sdur,$$isn.loc) is i
 %include inc_ISN
 if c.cans.isn dp
  GetEvent = $dbread(9,c.cans.isn,$$isn.ru,$$isn.loc,$$isn.sdur,$$isn.tm, $$isn.sac)
 endif 
 $allowupdate($$isn.sac,$$isn.ru,$$isn.tm,$$isn.sdur,$$isn.loc)
end GetEvent

function RLOCRpt() is null 
 c_cans_rloc = $dct(CansAuthLevelDCT,c.cans.rloc)
  $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  if c.cans.type = "1" or c.cans.type = "2" or c.cans.type = "12"
  $row(,col_color_multi)
   $col("center",,,"2")$text("Recommended Level Of Care","datatag")
   $row()
    $col("right",,"50%")$text(q_text_rloc,"datatag")
    $col()$text(c_cans_rloc)
   $row()
    $col("right",,"50%")$text(q_text_dloc,"datatag")
    $col()$dropboxdct(c.cans.dloc,CansAuthLevelDCT)
  elseif c.cans.type = "11"
  $row(,col_color_multi)
   $col("center",,,"2")$text("Recommended Level Of Care: Crisis","datatag")
   $row()
    $col("right",,"50%")$text(q_text_rloc,"datatag")
    $col()$text(c_cans_rloc)  
  elseif c.cans.type = "3"
  $row(,col_color_multi)
   $col("center",,,"2")$text("Discharge","datatag")  
  endif
  $row()
   $col("right",,"50%")$text(q_text_comment,"datatag")
   $col()$textblock(c.cans.comment,5,,,,255,"width:100%;")$countbox(c.cans.comment,"(max chars is 255)")
 $endtable($funcname)
end RLOCRpt


function StaffComments() is null
 s.fn is x
 s.ln is x
 (void)$dbread(3,c.cans.staff,s.fn,s.ln)
 $table($funcname,,"width='100%' cellspacing='0' cellpadding='2' bgcolor='White'  style='border-style: solid; border-width: 1px'")
  $row(,col_color_multi)
   $col("center",,,"2")$text("Staff Comments:","datatag")
  $row()
   $col("right",,"50%")$text("Assessor: ","datatag")
   $col()$text(`s.fn + " " + s.ln + " (" + c.cans.staff + ")"`)
  $row()
   $col("right",,"50%")$text(q_text_comment,"datatag")
   $col() if c.cans.comment dp
           $text(c.cans.comment)   
		  else
		   $text("No Comments Provided by Staff")
		  endif 
 $endtable($funcname)
end StaffComments 

function ClearPage1() is null
 if c.cans.type = "11"
  $clear(c.cans.cr.sfharm,c.cans.cr.aggbeh,c.cans.cr.socbeh)
 else 
  $clear(c.cans.cr.sfharm,c.cans.cr.aggbeh,c.cans.cr.socbeh)
  $clear(c.cans.cf.birthw,c.cans.cf.pica,c.cans.cf.prenat,c.cans.cf.labdel,c.cans.cf.subexp,c.cans.cf.psprob,c.cans.cf.matava,c.cans.cf.abuse)
  $clear(c.cans.cb.attach,c.cans.cb.regula,c.cans.cb.fthriv,c.cans.cb.depres,c.cans.cb.anxity,c.cans.cb.atypic,c.cans.cb.implsv,c.cans.cb.oppdef,c.cans.cb.adjtrm)
  $clear(c.cans.ld.family,c.cans.ld.livsit,c.cans.ld.preday,c.cans.ld.socFun,c.cans.ld.recret,c.cans.ld.develp,c.cans.ld.motor,c.cans.ld.commun,c.cans.ld.medicl,c.cans.ld.physcl,c.cans.ld.sleep ,c.cans.ld.relper )
  $clear(c.cans.cg.super,c.cans.cg.involv,c.cans.cg.knoldg,c.cans.cg.empath,c.cans.cg.organz,c.cans.cg.socres,c.cans.cg.ressbl,c.cans.cg.physcl)
  $clear(c.cans.cg.menhth,c.cans.cg.subabs,c.cans.cg.develp,c.cans.cg.chldcr,c.cans.cg.miltra,c.cans.cg.famsts,c.cans.cg.safety,c.cans.cg.marvio)
  $clear(c.cans.cs.family,c.cans.cs.extfam,c.cans.cs.intper,c.cans.cs.adapt,c.cans.cs.persis,c.cans.cs.curios)
  $clear(c.cans.ac.langua,c.cans.ac.identy,c.cans.ac.ritual,c.cans.ac.culstr,c.cans.ac.culdif)
 endif
end ClearPage1

function ClearPage2() is null
 $clear(c.cans.rg.eating,c.cans.rg.elim,c.cans.rg.sensor,c.cans.rg.emot)
 $clear(c.cans.tr.sexabs,c.cans.tr.phyabs,c.cans.tr.emoabs,c.cans.tr.medtrm,c.cans.tr.natdis,c.cans.tr.wtofam,c.cans.tr.wtocom,c.cans.tr.wcrime,c.cans.tr.waraff,c.cans.tr.teraff)
 $clear(c.cans.tr.react)
 $clear(c.cans.ad.affreg,c.cans.ad.reexp,c.cans.ad.avoid,c.cans.ad.incaro,c.cans.ad.numres,c.cans.ad.timb4t)
 $clear(c.cans.sc.prequa,c.cans.sc.pbehav,c.cans.sc.pachie,c.cans.sc.patten)
 $clear(c.cans.dv.cognit,c.cans.dv.selfcr)
 $clear(c.cans.fc.selfcr,c.cans.fc.culstr,c.cans.fc.empedu,c.cans.fc.eduatt,c.cans.fc.legal ,c.cans.fc.motive,c.cans.fc.finres,c.cans.fc.transp)
 $clear(c.cans.tr.emclos,c.cans.tr.freq,c.cans.tr.durat,c.cans.tr.force,c.cans.tr.react)
end ClearPage2

function ClearPage3() is null
 $clear(c.cans.tr.emclos,c.cans.tr.freq,c.cans.tr.durat,c.cans.tr.force,c.cans.tr.react)
end ClearPage3

function ClearPage4() is null
 $clear(c.cans.commdate,c.cans.school3m,c.cans.grade,c.cans.arrest,c.cans.restype,c.cans.resother1,
 c.cans.bipsq1, c.cans.bipsq2)
end ClearPage4

function AssessmentStaff() is null
 if StaffSelectDCT dp
  $table($funcname)
   $row()
    $col("right",,"50%")$text("Staff ID: ","datatag")
    $col()$dropboxdct(c.cans.staff,StaffSelectDCT,,,,"Y")
  $endtable($funcname)
 endif
end AssessmentStaff
