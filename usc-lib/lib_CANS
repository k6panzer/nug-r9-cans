library lib_CANS()
 function Allow_Assesment(clientid,assessments[]) is null
  clientid        is x
  c.cans.rec      is h
  c.cans.staff    is x
  c.cans.ver      is x
  c.cans.date     is d
  c.cans.age      is n
  c.cans.aloc     is x
  c.cans.rloc     is x
  c.cans.dloc     is x
  c.cans.compd    is d
  c.cans.type     is x
  c.cans.alocdate is d  
  rc              is i 
  assessments[]   is x
  $clear(assessments[])
  $allowupdate(assessments[])
  Last_Assessment(clientid,c.cans.type,c.cans.staff,c.cans.ver,c.cans.date,c.cans.age,c.cans.aloc,c.cans.rloc,c.cans.dloc,c.cans.compd,c.cans.alocdate)
  select c.cans.type
   case !dp  (void)$arrpush(assessments[],"1")
             (void)$arrpush(assessments[],"11")
   case "1"  (void)$arrpush(assessments[],"2")
             (void)$arrpush(assessments[],"3")
   case "2"  (void)$arrpush(assessments[],"3")
   case "3"  (void)$arrpush(assessments[],"1")
   case "11" (void)$arrpush(assessments[],"1")
   case "12" (void)$arrpush(assessments[],"1")
  endselect 
 end Allow_Assesment

 function Last_Assessment(clientid,c.cans.type,c.cans.staff,c.cans.ver,c.cans.date,c.cans.age,c.cans.aloc,c.cans.rloc,c.cans.dloc,c.cans.compd,c.cans.alocdate) is null
  clientid        is x
  c.cans.rec      is h
  c.cans.staff    is x
  c.cans.ver      is x
  c.cans.date     is d
  c.cans.age      is n
  c.cans.aloc     is x
  c.cans.rloc     is x
  c.cans.dloc     is x
  c.cans.compd    is d
  c.cans.type     is x
  c.cans.alocdate is d  
  rc              is i 
  $allowupdate(c.cans.type,c.cans.staff,c.cans.ver,c.cans.date,c.cans.age,c.cans.aloc,c.cans.rloc,c.cans.dloc,c.cans.compd) 
  do until c.cans.compd dp or rc = 2
   rc = $dbreadnextdst(02,clientid,c.cans.rec,c.cans.type,c.cans.staff,c.cans.ver,c.cans.date,c.cans.age,c.cans.aloc,c.cans.rloc,c.cans.dloc,c.cans.compd,c.cans.alocdate)
  enddo
 end Last_Assessment
 
 function EndDate(c.cans.aloc,c.cans.alocdate) is d
  c.cans.aloc     is x
  c.cans.alocdate is d
  select c.cans.aloc
   case "100" EndDate = c.cans.alocdate + 7
   case "101" EndDate = c.cans.alocdate + 90
   case "102" EndDate = c.cans.alocdate + 90
   case "103" EndDate = c.cans.alocdate + 90
   case "104" EndDate = c.cans.alocdate + 90
   case "105" EndDate = c.cans.alocdate + 90
   case "106" EndDate = c.cans.alocdate + 90
   case "107" EndDate = c.cans.alocdate + 7
  endselect 
 end EndDate
